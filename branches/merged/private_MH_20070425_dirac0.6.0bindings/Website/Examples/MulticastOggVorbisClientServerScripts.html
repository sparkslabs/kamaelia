<html><head><meta name="qrichtext" content="1" /></head><body style="font-size:10pt;font-family:URW Gothic L">
<p><span style="font-size:24pt;font-weight:600">Cookbook Example</span></p>
<p align="right"><span style="font-size:18pt">How can I...?</span></p>
<p dir="ltr">Example 4: Building a very simplistic multicast based streaming system using ogg vorbis. This time using 2 separate scripts. <span style="font-weight:600">Components used in server script: </span><span style="font-style:italic;color:#ff0004">component</span>, <a href="/Components/pydoc/Kamaelia.ReadFileAdaptor.ReadFileAdaptor.html">ReadFileAdaptor</a>, <a href="/Components/pydoc/Kamaelia.Internet.Multicast_transceiver.Multicast_transceiver.html">Multicast_transceiver</a>. <span style="font-weight:600">Components used in client script:</span> <span style="font-style:italic;color:#ff0004">component</span>, <a href="/Components/pydoc/Kamaelia.Internet.Multicast_transceiver.Multicast_transceiver.html">Multicast_transceiver</a>, <span style="font-style:italic;color:#ff0004">detuple</span> (defined in the example), <a href="/Components/pydoc/Kamaelia.vorbisDecodeComponent.VorbisDecode.html">VorbisDecode</a>, <a href="/Components/pydoc/Kamaelia.vorbisDecodeComponent.AOAudioPlaybackAdaptor.html">AOAudioPlaybackAdaptor</a>. </p>
<p dir="ltr">Server Script, the easy way</p>
<ul type="disc"><div dir="ltr">[[pre]<span style="font-style:italic">#!/usr/bin/python<br /><br /></span><span style="font-weight:600">from</span> Kamaelia.ReadFileAdaptor <span style="font-weight:600">import</span> ReadFileAdaptor<br /><span style="font-weight:600">from</span> Kamaelia.Internet.Multicast_transceiver <span style="font-weight:600">import</span> Multicast_transceiver<br /><span style="font-weight:600">from</span> Kamaelia.Util.PipelineComponent <span style="font-weight:600">import</span> pipeline<br /><br />file_to_stream = &quot;/usr/share/wesnoth/music/wesnoth-1.ogg&quot;<br /><br />pipeline(<br />    ReadFileAdaptor(file_to_stream, readmode=&quot;bitrate&quot;, bitrate=400000, chunkrate=50),<br />    Multicast_transceiver(&quot;0.0.0.0&quot;, 0, &quot;224.168.2.9&quot;, 1600),<br />).run()<br />]</div></ul>
<p dir="ltr"></p>
<p dir="ltr">Server Script, the hard way (but exactly equivalent)</p>
<ul type="disc"><div dir="ltr">[[pre]<span style="font-style:italic">#!/usr/bin/python</span><br /><br /><span style="font-weight:600">import</span> Axon<br /><br />file_to_stream = &quot;/usr/share/wesnoth/music/wesnoth-1.ogg&quot;<br /><br /><span style="font-weight:600">def</span> tests():<br />   <span style="font-weight:600">from</span> Axon.Scheduler import scheduler<br />   <span style="font-weight:600">import</span> Kamaelia.ReadFileAdaptor<br />   <span style="font-weight:600">from</span> Kamaelia.Internet.Multicast_transceiver <span style="font-weight:600">import</span> Multicast_transceiver<br /><br />   <span style="font-weight:600">class</span> testComponent(Axon.Component.component):<br />      <span style="font-weight:600">def</span> main(self):<br />        source = Kamaelia.ReadFileAdaptor.ReadFileAdaptor(file_to_stream,<br />                                                          readmode=&quot;bitrate&quot;,<br />                                                          bitrate=400000,<br />                                                          chunkrate=50)<br />        sender   = Multicast_transceiver(&quot;0.0.0.0&quot;, 0, &quot;224.168.2.9&quot;, 1600)<br />        self.link((source,&quot;outbox&quot;), (sender,&quot;inbox&quot;))<br /><br />        self.addChildren(source, sender)<br />        <span style="font-weight:600">yield</span> Axon.Ipc.newComponent(*(self.children))<br />        <span style="font-weight:600">while</span> 1:<br />           <span style="font-weight:600">yield</span> 1<br /><br />   harness = testComponent()<br />   harness.activate()<br />   scheduler.run.runThreads(slowmo=0)<br /><br /><span style="font-weight:600">if</span> __name__==&quot;__main__&quot;:<br /><br />    tests()<br />]<br /><span style="font-weight:600">Source: </span>Examples/example4/MulticastStreamingServer.py</div></ul>
<p dir="ltr"></p>
<p dir="ltr">Client Script</p>
<ul type="disc"><div dir="ltr">[[pre]<span style="font-style:italic">#!/usr/bin/python</span><br /><br /><span style="font-weight:600">from</span> Axon.Component <span style="font-weight:600">import</span> component<br /><span style="font-weight:600">from</span> Kamaelia.vorbisDecodeComponent <span style="font-weight:600">import</span> VorbisDecode, AOAudioPlaybackAdaptor<br /><span style="font-weight:600">from</span> Kamaelia.Internet.Multicast_transceiver <span style="font-weight:600">import</span> Multicast_transceiver<br /><span style="font-weight:600">from</span> Kamaelia.Util.PipelineComponent <span style="font-weight:600">import</span> pipeline<br /><br /><span style="font-weight:600">class</span> detuple(component):<br />   <span style="font-weight:600">def</span> __init__(self, index):<br />      super(detuple, self).__init__()<br />      self.index = index<br />   <span style="font-weight:600">def</span> main(self):<br />      <span style="font-weight:600">while</span> 1:<br />         <span style="font-weight:600">if</span> self.dataReady(&quot;inbox&quot;):<br />            tuple=self.recv(&quot;inbox&quot;)<br />            self.send(tuple[self.index], &quot;outbox&quot;)<br />         <span style="font-weight:600">yield</span> 1<br /><br /><span style="font-style:italic;font-weight:600"># Client</span><br />pipeline(<br />    Multicast_transceiver(&quot;0.0.0.0&quot;, 1600, &quot;224.168.2.9&quot;, 0),<br />    detuple(1),<br />    VorbisDecode(),<br />    AOAudioPlaybackAdaptor(),<br />).run()<br />]</div></ul>
<p dir="ltr">Client Script, the hard way (but exactly equivalent)</p>
<ul type="disc"><div dir="ltr">[[pre]<span style="font-style:italic">#!/usr/bin/python</span><br /><br /><span style="font-weight:600">import</span> Axon<br /><br /><span style="font-weight:600">class</span> detuple(Axon.Component.component):<br />   <span style="font-weight:600">def</span> __init__(self, index):<br />      super(detuple,self).__init__()<br />      self.index = index<br />   <span style="font-weight:600">def</span> main(self):<br />      <span style="font-weight:600">while</span> 1:<br />         <span style="font-weight:600">if</span> self.dataReady(&quot;inbox&quot;):<br />            tuple=self.recv(&quot;inbox&quot;)<br />            self.send(tuple[self.index], &quot;outbox&quot;)<br />         <span style="font-weight:600">yield</span> 1<br /><br /><span style="font-weight:600">def</span> tests():<br />   <span style="font-weight:600">from</span> Axon.Scheduler import scheduler<br />   <span style="font-weight:600">import</span> Kamaelia.ReadFileAdaptor<br />   <span style="font-weight:600">from</span> Kamaelia.vorbisDecodeComponent <span style="font-weight:600">import</span> VorbisDecode, AOAudioPlaybackAdaptor<br />   <span style="font-weight:600">from</span> Kamaelia.Internet.Multicast_transceiver <span style="font-weight:600">import</span> Multicast_transceiver<br /><br />   <span style="font-weight:600">class</span> testComponent(Axon.Component.component):<br />      <span style="font-weight:600">def</span> main(self):<br />        receiver = Multicast_transceiver(&quot;0.0.0.0&quot;, 1600, &quot;224.168.2.9&quot;, 0)<br />        detupler = detuple(1)<br />        decoder = VorbisDecode()<br />        player = AOAudioPlaybackAdaptor()<br /><br />        self.link((receiver,&quot;outbox&quot;), (detupler,&quot;inbox&quot;))<br />        self.link((detupler,&quot;outbox&quot;), (decoder,&quot;inbox&quot;))<br />        self.link((decoder,&quot;outbox&quot;), (player,&quot;inbox&quot;))<br /><br />        self.addChildren(receiver, detupler, decoder, player)<br />        <span style="font-weight:600">yield</span> Axon.Ipc.newComponent(*(self.children))<br />        <span style="font-weight:600">while</span> 1:<br />           <span style="font-weight:600">yield</span> 1<br /><br />   harness = testComponent()<br />   harness.activate()<br />   scheduler.run.runThreads(slowmo=0)<br /><br /><span style="font-weight:600">if</span> __name__==&quot;__main__&quot;:<br /><br />    tests()<br />]<br /><span style="font-weight:600">Source:</span> Examples/example4/MulticastStreamingClient.py</div></ul>
<p dir="ltr"></p>
<p dir="ltr"></p>
</body></html>
