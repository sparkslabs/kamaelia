<html><head><meta name="qrichtext" content="1" /></head><body style="font-size:10pt;font-family:URW Gothic L">
<p><span style="font-size:24pt;font-weight:600">Cookbook Example</span></p>
<p align="right"><span style="font-size:18pt">How can I...?</span></p>
<p>Example 9 : Simple component based game using pygame. This demonstrates use of a collection of simple physics behaviours components, Graphline to bind these to a BasicSprite component, an EventHandler to show how to deal with keyboard handling, a fanout component to help co-ordinate shutdown, and a specialised scheduler - the SpriteScheduler component to run these.  <span style="font-weight:600">Components used: </span><a href="/Components/pydoc/Kamaelia.Util.Graphline.Graphline.html">Graphline</a>, <a href="/Components/pydoc/Kamaelia.UI.Pygame.BasicSprite.BasicSprite.html">BasicSprite</a>, <a href="/Components/pydoc/Kamaelia.UI.Pygame.SpriteScheduler.SpriteScheduler.html">SpriteScheduler</a>, <span style="font-style:italic;color:#ff0004">EventHandler</span>, <a href="/Components/pydoc/Kamaelia.Util.Fanout.fanout.html">fanout</a>, <a href="/Components/pydoc/Kamaelia.Physics.Behaviours.bouncingFloat.html">bouncingFloat</a>, <a href="/Components/pydoc/Kamaelia.Physics.Behaviours.cartesianPingPong.html">cartesianPingPong</a>, <a href="/Components/pydoc/Kamaelia.Physics.Behaviours.loopingCounter.html">loopingCounter</a>, <a href="/Components/pydoc/Kamaelia.Physics.Behaviours.continuousIdentity.html">continuousIdentity</a>,  <a href="/Components/pydoc/Kamaelia.Physics.Behaviours.continuousZero.html">continuousZero</a>, <a href="/Components/pydoc/Kamaelia.Physics.Behaviours.continuousOne.html">continuousOne</a></p>
<p><span style="font-weight:600">Warnings</span>: if you're less than 4 you'll love this game ;-) Also, This isn't quite integrated with the PyGameApp code, but shows a nice way of writing simple games.</p>
<ul type="disc"><div dir="ltr">[[pre]<span style="font-style:italic">#!/usr/bin/python<br /><br /></span><span style="font-weight:600">import</span> pygame<br /><span style="font-weight:600">import</span> random<br /><span style="font-weight:600">import</span> os<br /><br /><span style="font-weight:600">from</span> Kamaelia.Util.Graphline <span style="font-weight:600">import</span> Graphline<br /><span style="font-weight:600">from</span> Kamaelia.UI.Pygame.BasicSprite <span style="font-weight:600">import</span> BasicSprite<br /><span style="font-weight:600">from</span> Kamaelia.Physics.Behaviours <span style="font-weight:600">import</span> bouncingFloat, cartesianPingPong, loopingCounter, continuousIdentity,  continuousZero, continuousOne<br /><span style="font-weight:600">from</span> Kamaelia.UI.Pygame.EventHandler <span style="font-weight:600">import</span> EventHandler<br /><span style="font-weight:600">from</span> Kamaelia.Util.Fanout <span style="font-weight:600">import</span> fanout<br /><span style="font-weight:600">from</span> Kamaelia.UI.Pygame.SpriteScheduler <span style="font-weight:600">import</span> SpriteScheduler<br /><br />banner_location = &quot;banner.gif&quot;<br />cat_location    = &quot;cat.gif&quot;<br />cat_pop_wav_file     = &quot;hold.wav&quot;<br />cat_appear_wav_file  = &quot;KDE_Beep_Bottles.wav&quot;<br />screensize      = (700,550)<br />back_colour     = (255,255,255)<br />border          = 40<br />flags = pygame.DOUBLEBUF<br /><br />cat_pop_wav = pygame.mixer.Sound(cat_pop_wav_file)<br />cat_appear_wav = pygame.mixer.Sound(cat_appear_wav_file)<br /><br />pygame.init()<br /><span style="font-style:italic"># --------------------------------------------------------------------------</span><br /><br /><span style="font-weight:600">def</span> makeAndInitialiseBackground(banner_location, screensize,<br />                                screen_surface, back_colour):<br />    <span style="font-style:italic">#</span><br />    <span style="font-style:italic"># Load images for background</span><br />    <span style="font-style:italic">#</span><br />    banner_surface = pygame.image.load(banner_location)<br />    banner = banner_surface.convert()<br />    surface = banner_surface<br />    width = banner_surface.get_width()<br />    height = banner_surface.get_height()<br /><br />    <span style="font-style:italic">#</span><br />    <span style="font-style:italic"># Calculate position for image, relative to screen size.</span><br />    <span style="font-style:italic"># This is calculated as a rectangle</span><br />    <span style="font-style:italic">#</span><br />    horizonal_to_move = (screensize[0] - width)/2<br />    vertical_to_move = (screensize[1] - height)/2<br />    rect = banner_surface.get_rect()<br />    rect = rect.move([horizonal_to_move,vertical_to_move])<br /><br />    <span style="font-style:italic"># Create the actual background, and then insert the image(s) into the</span><br />    <span style="font-style:italic"># background.</span><br />    <span style="font-style:italic">#</span><br />    background = pygame.Surface(screen_surface.get_size())<br />    background = background.convert()<br />    background.fill(back_colour)<br />    background.blit(banner_surface, rect)<br /><br />    <span style="font-style:italic">#</span><br />    <span style="font-style:italic"># Finally, return the completed background.</span><br />    <span style="font-style:italic">#</span><br />    <span style="font-weight:600">return</span> background<br /><br /><span style="font-weight:600">def</span> randomFromRangeExcludingZero(min,max):<br />    result = 0<br />    <span style="font-weight:600">while</span> result == 0:<br />        result = random.randint(min,max)<br />    <span style="font-weight:600">return</span> result<br /><br /><span style="font-weight:600">def</span> make_cat(cat_location, screensize, border ):<br />    <span style="font-style:italic"># Get the cat again!</span><br />    files = list()<br />    <span style="font-weight:600">for</span> x <span style="font-weight:600">in</span> os.listdir(&quot;pictures&quot;):<br />        <span style="font-weight:600">if</span> x <span style="font-weight:600">not in</span> (&quot;README&quot;,&quot;CVS&quot;):<br />            files.append(x)<br /><br />    image_location = files[random.randint(0,len(files)-1)]<br /><br />    cat_surface = pygame.image.load(&quot;pictures/&quot;+image_location)<br />    cat = cat_surface.convert()<br />    cat.set_colorkey((255,255,255), pygame.RLEACCEL)<br /><br />    rotation_speed = randomFromRangeExcludingZero(-2,2)<br />    scale_speed = float(randomFromRangeExcludingZero(-1,1))<br />    position = list( (random.randint(border,screensize[0]-border),<br />                     random.randint(border,screensize[1]-border)))<br /><br />    newCat = BasicSprite(image=cat)<br /><br />    X = Graphline(<br />       newCat = newCat,<br />       rotator = loopingCounter(rotation_speed),<br />       translation = cartesianPingPong(position,screensize[0],screensize[1],border),<br />       scaler = bouncingFloat(scale_speed),<br />       imaging = continuousIdentity(cat),<br />       shutdown_fanout = fanout([&quot;rotator&quot;,&quot;translation&quot;,&quot;scaler&quot;, &quot;imaging&quot;,&quot;self_shutdown&quot;]),<br />       linkages = {<br />           (&quot;rotator&quot;,&quot;outbox&quot; ) : (&quot;newCat&quot;, &quot;rotator&quot;),<br />           (&quot;translation&quot;,&quot;outbox&quot; ) : (&quot;newCat&quot;, &quot;translation&quot;),<br />           (&quot;scaler&quot;,&quot;outbox&quot; ) : (&quot;newCat&quot;, &quot;scaler&quot;),<br />           (&quot;imaging&quot;,&quot;outbox&quot; ) : (&quot;newCat&quot;, &quot;imaging&quot;),<br />           (&quot;newCat&quot;, &quot;signal&quot; ): (&quot;shutdown_fanout&quot;, &quot;inbox&quot;),<br />           (&quot;shutdown_fanout&quot;, &quot;rotator&quot;) : (&quot;rotator&quot;, &quot;control&quot;),<br />           (&quot;shutdown_fanout&quot;, &quot;translation&quot;) : (&quot;translation&quot;, &quot;control&quot;),<br />           (&quot;shutdown_fanout&quot;, &quot;scaler&quot;) : (&quot;scaler&quot;, &quot;control&quot;),<br />           (&quot;shutdown_fanout&quot;, &quot;imaging&quot;) : (&quot;imaging&quot;, &quot;control&quot;),<br />           (&quot;shutdown_fanout&quot;, &quot;self_shutdown&quot;) : (&quot;shutdown_fanout&quot;, &quot;control&quot;),<br />       }<br />    ).activate()<br /><br />    <span style="font-weight:600">return</span> newCat<br /><br /><span style="font-weight:600">def</span> make_cats(cat_location, screensize, border, numberCats=20):<br />    cat_sprites = []<br />    <span style="font-weight:600">for</span> i <span style="font-weight:600">in</span> range(numberCats):<br />        <span style="font-style:italic"># Need to load the image separately for each sprite...</span><br />        newCat = make_cat(cat_location, screensize, border)<br />        cat_sprites.append(newCat)<br />    <span style="font-weight:600">return</span> cat_sprites<br /><br /><span style="font-weight:600">class</span> MyGamesEvents(EventHandler):<br />    <span style="font-weight:600">def</span> __init__(self, cat_args, trace=1, ):<br />        self.trace = 0<br />        self.cat_args = cat_args<br />    <span style="font-weight:600">def</span> mousebuttondown(self, pos, button, where):<br />        <span style="font-weight:600">if</span> button == 1:<br />            channel = cat_appear_wav.play()<br />            newCat = make_cat(*self.cat_args)<br />            cat_sprite = newCat<br />            where.allsprites.add(cat_sprite)<br />        <span style="font-weight:600">if</span> button == 2:<br />            sprites = where.allsprites.sprites()<br />            <span style="font-weight:600">for</span> sprite <span style="font-weight:600">in</span> sprites:<br />                <span style="font-weight:600">if</span> sprite.rect.collidepoint(*pos):<br />                    sprite.togglePause()<br />        <span style="font-weight:600">if</span> button == 3:<br />           <span style="font-style:italic"># Make a sprite disappear</span><br />           channel = cat_pop_wav.play()<br />           sprites = where.allsprites.sprites()<br />           popped = 0<br />           <span style="font-weight:600">for</span> sprite <span style="font-weight:600">in</span> sprites:<br />               <span style="font-weight:600">if</span> sprite.rect.collidepoint(*pos):<br />                   spriteToZap = sprite<br />                   spriteToZap.shutdown()<br />                   where.allsprites.remove(spriteToZap)<br />                   <span style="font-weight:600">return</span><br />           <span style="font-weight:600">try:</span><br />               spriteToZap = sprites[len(sprites)-1]<br />           <span style="font-weight:600">except</span> IndexError:<br />               <span style="font-weight:600">pass</span><br />           <span style="font-weight:600">else:</span><br />               spriteToZap.shutdown()<br />               where.allsprites.remove(spriteToZap)<br />    <span style="font-weight:600">def </span>keydown(self, unicode, key, mod, where):<br />        <span style="font-weight:600">if</span> key == 112: <span style="font-style:italic"># &quot;P&quot;</span><br />            <span style="font-style:italic"># PAUSE ALL MOVEMENT</span><br />            <span style="font-weight:600">for</span> sprite <span style="font-weight:600">in</span> where.allsprites.sprites():<br />                sprite.pause()<br />        <span style="font-weight:600">if</span> key == 113: <span style="font-style:italic"># &quot;Q&quot;</span><br />            <span style="font-weight:600">raise</span> &quot;QUIT&quot;<br />        <span style="font-weight:600">if</span> key == 117: <span style="font-style:italic"># &quot;U&quot;</span><br />            <span style="font-style:italic"># UNPAUSE ALL MOVEMENT</span><br />            <span style="font-weight:600">for</span> sprite <span style="font-weight:600">in</span> where.allsprites.sprites():<br />                sprite.unpause()<br />        <span style="font-weight:600">if</span> key == 116: <span style="font-style:italic"># &quot;T&quot;</span><br />            <span style="font-style:italic"># Toggle PAUSE ALL MOVEMENT</span><br />            <span style="font-weight:600">for</span> sprite <span style="font-weight:600">in</span> where.allsprites.sprites():<br />                sprite.togglePause()<br /><br />screen_surface = pygame.display.set_mode(screensize, flags)<br />background = makeAndInitialiseBackground(banner_location, screensize, screen_surface,back_colour)<br />cat_sprites = make_cats(cat_location, screensize, border,1)<br />cat_args = (cat_location, screensize, border)<br /><br /><span style="font-weight:600">try:</span><br />    SpriteScheduler(cat_args, cat_sprites, background, screen_surface, MyGamesEvents).run()<br /><span style="font-weight:600">except:</span><br />    pass<br /><br />] <span style="font-weight:600">Source:</span> Examples/example9/Simplegame.py</div></ul>
<p dir="ltr"></p>
</body></html>
