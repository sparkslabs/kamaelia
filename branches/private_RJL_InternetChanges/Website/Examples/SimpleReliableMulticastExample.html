<html><head><meta name="qrichtext" content="1" /></head><body style="font-size:10pt;font-family:URW Gothic L">
<p><span style="font-size:24pt;font-weight:600">Cookbook Example</span></p>
<p align="right"><span style="font-size:18pt">How can I...?</span></p>
<p>Example 4: Building some reliability into the system (<a href="/SimpleReliableMulticast.html">Simple Reliable Multicast</a>). Idea is to show layering of protocols.<span style="font-weight:600"> Components used: </span><span style="font-style:italic;color:#ff0004">component</span>, <a href="/Components/pydoc/Kamaelia.ReadFileAdaptor.ReadFileAdaptor.html">ReadFileAdaptor</a>, <a href="/Components/pydoc/Kamaelia.vorbisDecodeComponent.VorbisDecode.html">VorbisDecode</a>, <a href="/Components/pydoc/Kamaelia.vorbisDecodeComponent.AOAudioPlaybackAdaptor.html">AOAudioPlaybackAdaptor</a>, <a href="/Components/pydoc/Kamaelia.Internet.Multicast_transceiver.Multicast_transceiver.html">Multicast_transceiver</a>, <a href="/Components/pydoc/Kamaelia.Util.PipelineComponent.pipeline.html">pipeline</a>, <span style="font-style:italic;color:#ff0004">SRM_Sender</span>, <span style="font-style:italic;color:#ff0004">SRM_Receiver</span></p>
<ul type="disc"><div dir="ltr">[[pre]<span style="font-style:italic">#!/usr/bin/python</span><br /><br /><span style="font-weight:600">from</span> Axon.Component <span style="font-weight:600">import</span> component<br /><span style="font-weight:600">from</span> Kamaelia.ReadFileAdaptor <span style="font-weight:600">import</span> ReadFileAdaptor<br /><span style="font-weight:600">from</span> Kamaelia.vorbisDecodeComponent <span style="font-weight:600">import</span> VorbisDecode, AOAudioPlaybackAdaptor<br /><span style="font-weight:600">from</span> Kamaelia.Internet.Multicast_transceiver <span style="font-weight:600">import</span> Multicast_transceiver<br /><span style="font-weight:600">from</span> Kamaelia.Util.PipelineComponent <span style="font-weight:600">import</span> pipeline<br /><span style="font-weight:600">from</span> Kamaelia.Protocol.SimpleReliableMulticast <span style="font-weight:600">import</span> SRM_Sender, SRM_Receiver<br /><br />file_to_stream = &quot;/usr/share/wesnoth/music/wesnoth-1.ogg&quot;<br /><br /><span style="font-weight:600">class</span> detuple(component):<br />   <span style="font-weight:600">def</span> __init__(self, index):<br />      super(detuple, self).__init__()<br />      self.index = index<br />   <span style="font-weight:600">def</span> main(self):<br />      <span style="font-weight:600">while</span> 1:<br />         <span style="font-weight:600">if</span> self.dataReady(&quot;inbox&quot;):<br />            tuple=self.recv(&quot;inbox&quot;)<br />            self.send(tuple[self.index], &quot;outbox&quot;)<br />         <span style="font-weight:600">yield</span> 1<br /><br /><span style="font-weight:600">class</span> blockise(component):<br />    <span style="font-weight:600">def</span> main(self):<br />       maxlen = 1000 # Needs to be parameterisable<br />       buffer = &quot;&quot;<br />       <span style="font-weight:600">while</span> 1:<br />           <span style="font-weight:600">if</span> self.dataReady(&quot;inbox&quot;):<br />               buffer = buffer + self.recv(&quot;inbox&quot;)<br />               <span style="font-weight:600">if</span> len(buffer) &gt; maxlen:<br />                  send = buffer[:maxlen]<br />                  buffer = buffer[maxlen:]<br />               <span style="font-weight:600">else</span>:<br />                  send = buffer<br />                  buffer = &quot;&quot;<br />               self.send(send, &quot;outbox&quot;)<br />           <span style="font-weight:600">yield</span> 1<br /><br /><span style="font-style:italic;font-weight:600">#<br /># Server with simple added reliabilty protocol<br />#<br /></span>pipeline(<br />    ReadFileAdaptor(file_to_stream, readmode=&quot;bitrate&quot;, bitrate=400000, chunkrate=50),<br /><span style="font-weight:600">    SRM_Sender(),<br />    blockise(), # Ensure chunks small enough for multicasting!<br /></span>    Multicast_transceiver(&quot;0.0.0.0&quot;, 0, &quot;224.168.2.9&quot;, 1600),<br />).activate()<br /><br /><span style="font-style:italic;font-weight:600">#<br /># Client with simple added reliability protocol<br />#<br /></span>pipeline(<br />    Multicast_transceiver(&quot;0.0.0.0&quot;, 1600, &quot;224.168.2.9&quot;, 0),<br />    detuple(1),<br /><span style="font-weight:600">    SRM_Receiver(),<br />    detuple(1),<br /></span>    VorbisDecode(),<br />    AOAudioPlaybackAdaptor(),<br />).run()<br />]<br /><span style="font-weight:600">Source: </span>Examples/example4/MulticastStreamingSystem_SRM.py</div></ul>
<p></p>
</body></html>
