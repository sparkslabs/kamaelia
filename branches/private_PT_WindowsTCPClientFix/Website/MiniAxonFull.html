<html><head><meta name="qrichtext" content="1" /></head><body style="font-size:10pt;font-family:URW Gothic L">
<p><span style="font-size:24pt;font-weight:600">Mini-Axon (complete)</span></p>
<p align="right"><span style="font-size:16pt">A Kamaelia Core in a Microcosm</span></p>
<p>See also: <a href="MiniAxon.html">Mini Axon</a>.</p>
<p dir="ltr"><span style="font-family:Courier;font-weight:400">[[pre]</span></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:400">class microprocess(object):<br />    def __init__(self):<br />        super(microprocess, self).__init__()<br />    def main(self):<br />        yield 1</span></p>
<p><span style="font-family:Courier;font-weight:400">class scheduler(microprocess):<br />    def __init__(self):<br />        super(scheduler, self).__init__()<br />        self.active = []<br />        self.newqueue = []<br />    def main(self): <br />        for i in xrange(100):<br />            for current in self.active:<br />                yield 1<br />                try:<br />                    result = current.next()<br />                    if result is not -1:<br />                        self.newqueue.append(current)<br />                except StopIteration:<br />                    pass<br />            self.active = self.newqueue<br />            self.newqueue = []<br />    def activateMicroprocess(self, someprocess):<br />        microthread = someprocess.main()<br />        self.newqueue.append(microthread)</span></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:400">class component(microprocess):<br />    Boxes = {<br />        &quot;inbox&quot; : &quot;This is where we expect to receive messages for work&quot;,<br />        &quot;outbox&quot; : &quot;This is where we expect to send results/messages to after doing work&quot;<br />    }<br />    def __init__(self):<br />        super(component, self).__init__()<br />        self.boxes = {}<br />        for box in self.Boxes:<br />            self.boxes[box] = list()<br />    def send(self, value, outboxname):<br />        self.boxes[outboxname].append(value)<br />    def recv(self, inboxname):<br />        result = self.boxes[inboxname][0]<br />        del self.boxes[inboxname][0]<br />        return result<br />    def dataReady(self, inboxname):<br />        return len(self.boxes[inboxname])</span></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:400">class postman(microprocess):<br />    def __init__(self, source, sourcebox, sink, sinkbox):<br />        self.source = source<br />        self.sourcebox = sourcebox<br />        self.sink = sink<br />        self.sinkbox = sinkbox<br />    def main(self):<br />        while 1:<br />            yield 1<br />            if self.source.dataReady(self.sourcebox):<br />                d = self.source.recv(self.sourcebox)<br />                self.sink.send(d, self.sinkbox)</span></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:400">]</span></p>
<p dir="ltr"><span style="font-size:14pt">#<br /># Some sample code using the mini component<br /># system defined above<br />#</span></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:400">[[pre]</span></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:400">class Producer(component):<br />    def __init__(self, message):<br />        super(Producer, self).__init__()<br />        self.message = message<br />    def main(self):<br />        while 1:<br />            yield 1<br />            self.send(self.message, &quot;outbox&quot;)<br /><br />class Consumer(component):<br />    def main(self):<br />        count = 0<br />        while 1:<br />            yield 1<br />            count += 1 # This is to show our data is changing :-)<br />            if self.dataReady(&quot;inbox&quot;):<br />                data = self.recv(&quot;inbox&quot;)<br />                print data, count<br /><br />p = Producer(&quot;Hello World&quot;)<br />c = Consumer()<br />postie = postman(p, &quot;outbox&quot;, c, &quot;inbox&quot;)<br /><br />myscheduler = scheduler()<br />myscheduler.activateMicroprocess(p)<br />myscheduler.activateMicroprocess(c)<br />myscheduler.activateMicroprocess(postie)<br /><br />for _ in myscheduler.main():<br />    pass</span></p>
<p>]</p>
</body></html>
