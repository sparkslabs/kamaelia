<html><head><meta name="qrichtext" content="1" /></head><body style="font-size:10pt;font-family:URW Gothic L">
<p><span style="font-size:24pt;font-weight:600">Using Pyrex To Write Components</span></p>
<p>First stab at writing Kamaelia Components using Pyrex. This code uses Pyrex 0.9.3, and has some issues that need resolving, but this does actually work.</p>
<p><span style="font-size:14pt;font-weight:600">File: pyrexcomponent.pyx</span></p>
<ul type="disc"><div><span style="font-family:Courier">#<br /># Simple pyrex component<br />#<br /><br />import Axon.Component.component<br /><br />cdef class test(Axon.Component.component):</span></div>
<ul type="disc"><div><span style="font-family:Courier">def mainBody(self):</span></div>
<ul type="disc"><div><span style="font-family:Courier">if self.dataReady(&quot;inbox&quot;):</span></div>
<ul type="disc"><div><span style="font-family:Courier">data = self.recv(&quot;inbox&quot;)<br />self.send(data, &quot;outbox&quot;)</span></div></ul>
<div><span style="font-family:Courier">return 1</span></div></ul></ul></ul>
<p><span style="font-size:14pt;font-weight:600">File: Axon.Component.pxd</span></p>
<ul type="disc"><div><span style="font-family:Courier">class component:</span></div>
<ul type="disc"><div><span style="font-family:Courier">pass</span></div></ul></ul>
<p><span style="font-size:14pt;font-weight:600">File: setup.py</span></p>
<ul type="disc"><div><span style="font-family:Courier">from distutils.core import setup<br />from distutils.extension import Extension<br />from Pyrex.Distutils import build_ext<br /><br />setup(</span></div>
<ul type="disc"><div dir="ltr"><span style="font-family:Courier">name = 'PyrexComponent',</span></div>
<div dir="ltr"><span style="font-family:Courier">ext_modules=list(</span></div>
<ul type="disc"><div dir="ltr"><span style="font-family:Courier">Extension(&quot;pyrexcomponent&quot;,</span></div>
<ul type="disc"><div dir="ltr"><span style="font-family:Courier">[&quot;pyrexcomponent.pyx&quot;],</span></div></ul>
<div dir="ltr"><span style="font-family:Courier">),</span></div></ul>
<div dir="ltr"><span style="font-family:Courier"> ),</span></div>
<div dir="ltr"><span style="font-family:Courier">cmdclass = {'build_ext': build_ext}</span></div></ul>
<div dir="ltr"><span style="font-family:Courier">)</span></div></ul>
<p><span style="font-size:14pt;font-weight:600">Build</span></p>
<ul type="disc"><div>&gt; <span style="font-style:italic;font-weight:600">sudo python setup.py install<br /></span>Password:<br />running install<br />running build<br />running build_ext<br />building 'pyrexcomponent' extension<br />.../pyrex/Axon.Component.pxd:1:0: class definition not allowed here<br />.../pyrex/pyrexcomponent.pyx:7:5: 'component' is not declared<br />&gt; <span style="font-style:italic;font-weight:600">sudo python setup.py install<br /></span>running install<br />running build<br />running build_ext<br />building 'pyrexcomponent' extension<br />gcc -pthread -fno-strict-aliasing -DNDEBUG -O2 -march=i586 -mcpu=i686 -fmessage-length=0 -Wall -g -fPIC -I/usr/include/python2.4 -c<br />pyrexcomponent.c -o build/temp.linux-i686-2.4/pyrexcomponent.o<br />pyrexcomponent.c: In function `__pyx_tp_new_14pyrexcomponent_test':<br />pyrexcomponent.c:187: warning: unused variable `p'<br />pyrexcomponent.c: In function `__pyx_tp_dealloc_14pyrexcomponent_test':<br />pyrexcomponent.c:192: warning: unused variable `p'<br />pyrexcomponent.c: In function `__pyx_tp_traverse_14pyrexcomponent_test':<br />pyrexcomponent.c:197: warning: unused variable `e'<br />pyrexcomponent.c:198: warning: unused variable `p'<br />pyrexcomponent.c: In function `__pyx_tp_clear_14pyrexcomponent_test':<br />pyrexcomponent.c:203: warning: unused variable `p'<br />pyrexcomponent.c: At top level:<br />pyrexcomponent.c:12: warning: `__Pyx_UnpackItem' declared `static' but never defined<br />pyrexcomponent.c:13: warning: `__Pyx_EndUnpack' declared `static' but never defined<br />pyrexcomponent.c:14: warning: `__Pyx_PrintItem' declared `static' but never defined<br />pyrexcomponent.c:15: warning: `__Pyx_PrintNewline' declared `static' but never defined<br />pyrexcomponent.c:16: warning: `__Pyx_Raise' declared `static' but never defined<br />pyrexcomponent.c:17: warning: `__Pyx_ReRaise' declared `static' but never defined<br />pyrexcomponent.c:19: warning: `__Pyx_GetExcValue' declared `static' but never defined<br />pyrexcomponent.c:20: warning: `__Pyx_ArgTypeTest' declared `static' but never defined<br />pyrexcomponent.c:21: warning: `__Pyx_TypeTest' declared `static' but never defined<br />pyrexcomponent.c:22: warning: `__Pyx_GetStarArgs' declared `static' but never defined<br />pyrexcomponent.c:23: warning: `__Pyx_WriteUnraisable' declared `static' but never defined<br />pyrexcomponent.c:25: warning: `__Pyx_ImportType' declared `static' but never defined<br />pyrexcomponent.c:26: warning: `__Pyx_SetVtable' declared `static' but never defined<br />pyrexcomponent.c:27: warning: `__Pyx_GetVtable' declared `static' but never defined<br />pyrexcomponent.c:28: warning: `__Pyx_CreateClass' declared `static' but never defined<br />pyrexcomponent.c:31: warning: `__Pyx_GetName' declared `static' but never defined<br />gcc -pthread -shared build/temp.linux-i686-2.4/pyrexcomponent.o -o build/lib.linux-i686-2.4/pyrexcomponent.so<br />running install_lib<br />copying build/lib.linux-i686-2.4/pyrexcomponent.so -&gt; /usr/lib/python2.4/site-packages</div></ul>
<p><span style="font-size:14pt;font-weight:600">Creating an instance</span></p>
<ul type="disc"><div dir="ltr">&gt;<span style="font-style:italic;font-weight:600"> python<br /></span>Python 2.4 (#1, Mar 22 2005, 21:42:42)<br />[GCC 3.3.5 20050117 (prerelease) (SUSE Linux)] on linux2<br />Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.<br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">from Axon.Component import component<br /></span>&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">import pyrexcomponent<br /></span>Traceback (most recent call last):<br />  File &quot;&lt;stdin&gt;&quot;, line 1, in ?<br />  File &quot;pyrexcomponent.pyx&quot;, line 12, in pyrexcomponent<br />    import Axon.Component.component<br />ImportError: No module named component<br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">import pyrexcomponent</span><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">pyrexcomponent</span><br />&lt;module 'pyrexcomponent' (built-in)&gt;<br /><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">class foo(pyrexcomponent.test, component): pass</span><br />...<br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x=foo()</span><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x</span><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">component.__init__(x)</span><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x.inboxes</span><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x.mainBody</span><br />&lt;built-in method mainBody of foo object at 0x404a4a04&gt;<br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x.mainBody.__doc__</span><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x.activate()</span><br />&lt;__main__.foo object at 0x404a4a04&gt;<br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x.mainBody.__doc__</span><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x._deliver(&quot;hello&quot;)</span><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x._deliver(&quot;world&quot;)</span><br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x.next()</span><br />1<br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x.next()</span><br />1<br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x.next()</span><br />1<br />&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x._collect()</span></div>
<div dir="ltr">'hello'</div>
<div dir="ltr">&gt;&gt;&gt; <span style="font-style:italic;font-weight:600">x._collect()</span></div>
<div dir="ltr">'world'</div></ul>
<p><span style="font-size:14pt;font-weight:600">Summary</span></p>
<p>There's clearly some minor issues here and scope for improvement, but this clearly shows that you <span style="font-style:italic">can</span> write components in pyrex, which therefore means you can pull in any library with a C interface with relative ease.</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
</body></html>
