<html>
<head>
<title> AxonHandle </title>
<meta name="description" content="Kamaelia - making concurrency simpler in python - AxonHandle">
<meta name="keywords" content="python concurrency generators threads processes component system experts beginners media networking">
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
<span class="largertext">&nbsp;</span>
<!--   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span>  -->
<!--  </b> -->
</b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twoC column">
                    &nbsp;
                </div>
                <div class="eightC column">
                













<h1>Axon Component Handles</h1>The purpose behind Axon.Handle's is to allow the use of Kamaelia based components and systems in non-Kamaelia systems, in a relatively intuitive way.<br><h2>Premise</h2><p>The name <b>Handle</b> derives from the concept of a file-handle. We dropped the name "LikeFile" since whilst it derives from the concept of a file handle, it doesn't use the same API as file() for some good reasons we'll come back to.<br></p><p>A file handle is an opaque thing that you can <i>.write()</i> data to, and <i>.read()</i> data from. This is a very simple concept and belies a huge amount of parallel activity happening concurrently to your application. The file system is taking your data and typically buffering it into blocks. Those blocks then may need padding, and depending on the file system, may actually be written immediately to the end of a cyclone buffer in a journal with some write operations. Then periodically those buffers get flushed to the actual disk.</p>Based on the fact that file handles are a very natural thing for people to work with, based on their ubiquity, and the fact that it masks the fact you're accessing a concurrent system from a linear one, that's why we've taken this approach for integrating Kamaelia components (which are naturally parallel) with non-Kamaelia code, which is typically not parallel.<br><p>For simplicity of implementation, initially the implementation of Handle supports only the equivalent of non-blocking file handles. This has two implications:</p><ul><li>Reading data from a Handle may fail, since there may not be any ready yet. This is chosen in preference to a blocking operation<br></li><li>Writing data to a Handle may also fail, since the component may not actually be ready to receive data from us.<br></li></ul><h2>Running the Axon Scheduler in the Background</h2>Clearly for this to work, Kamaelia's core - Axon - needs a way of running components in the background. ie a way of putting the scheduler in the background. This is actually pretty trivial, and can be used in a very basic way (say, to run an Echo Protocol server in the background) like this:<br><br><blockquote>
<pre>from Axon.background import background<br><br><font color="#009900"># Start the scheduler in a background thread<br>#<br></font>background().start()<br><br><font color="#009900"># Add something to run in the background.</font><br>from Kamaelia.Protocol.EchoProtocol import EchoProtcol<br>from Kamaelia.Chassis.ConnectedServer import SimpleServer<br><br><font color="#009900"># Due to background().start() above, the following starts running in<br># the background immediately. <br></font>SimpleServer(protocol=EchoProtcol, port=1500).activate()<br><br><font color="#009900"># Do something else in the foreground.<br></font>import time<br>while 1:<br>     time.sleep(1)<br>     print "Ptang!"</pre></blockquote>As should be clear from this, the scheduler is started in the background, the server is activated and then system sits waiting for people to connect whilst periodically going "Ptang!"<br><h2>Example Component</h2><p>We'll use the following component in our examples below:</p><blockquote><pre>class Reverser(Axon.Component.component):<br>    Inboxes = {<br>         "inbox": "We receive data to reverse here",<br>         "control": "We shutdown when a message is sent here"<br>    }<br>    Outboxes = {<br>         "outbox": "We pass on the reversed message here",<br>         "signal": "We pass on any shutdown message that we receive here."<br>    }<br><br>    def main(self):<br>        while not self.dataReady("control):<br>            while self.dataReady('inbox'):<br>                item = self.recv('inbox')<br>                self.send(item[::-1], 'outbox') # reverse the string<br><br>            if not self.anyReady():<br>                self.pause()<br><br>            yield 1<br><br>        self.send( self.recv("control), "signal" ) # pass on the shutdown</pre></blockquote>Now, clearly this is a simple component, but it be anything. If could for example be a component that forwards each line to translate.google.com or babelfish.av.com, to translate the provided words into a different language. The usage would still be the same - messages coming in inbox "inbox", and transformed data coming out outbox "outbox".<br><h2>Usage</h2>Given the example component above, we decide to manually feed it the contents of stdin.<br><p>First of all we need our imports:<br></p><blockquote><pre>from Axon.Handle import Handle</pre><pre>from Axon.background import background</pre><pre>import Queue</pre></blockquote><p>Queue is needed because currently the exceptions thrown by Handle (when the Handle isn't ready) are from that module.<br></p><p>Start the scheduler in the background:</p><blockquote><pre>background().start()<br></pre></blockquote><p>Start our Reverser component in the background, inside a Handle:</p><blockquote><pre>reverser = Handle(Reverser()).activate()<br></pre></blockquote><p>The it's just a matter of using it:</p><blockquote><pre>while True:<br>    line = sys.stdin.readline()<br>    if line == "":<br>       break<br>    line = line.rstrip() # get rid of newline - looks odd otherwise :)<br><br><font color="#009900"><b>    reverser.put(line, "inbox")</b></font><br><br>    while 1:<br>        try:<br><font color="#3333ff"><b>            enil = reverser.get("outbox")</b></font><br>            break<br><font color="#cc0000"><b>        except Queue.Empty:</b></font><br>            time.sleep(0.1)<br><br>    print enil</pre></blockquote><p>What should be clear here is that we feed data into the reverser using the .put() method.</p><p>The reason why we don't use a file-like object[1] here also becomes clear : 1) unlike read()/write() we have multiple possible destinations for the data - "inbox", "control", and we also have multiple sources of data "outbox", "signal". 2) Also, rather than shipping over binary data, we're passing over arbitrary python objects. Whilst in this case this happens to be strings it could be anything from simple records in dictionaries through to video data.<br></p><blockquote><p>[1] ie using the file API of write/read</p></blockquote><h2>Other Examples</h2>Other examples are in the Axon distribution and also in the Kamaelia Distribution. These can be browsed online here:<br><ul><li><a href="http://code.google.com/p/kamaelia/source/browse/trunk/Code/Python/Axon/Examples/Handles/">Axon Handle Examples</a></li><li><a href="http://code.google.com/p/kamaelia/source/browse/trunk/Code/Python/Kamaelia/Examples/Handles/">Kamaelia Handle Examples</a></li></ul><p></p><h2>Limitations</h2><p>Limitations:<br></p><ul><li>It currently will only allow access to components with the default/standard inboxes of inbox/control/signal/outbox.</li><li>This is a known limitation, but covers a wide class of situations.</li></ul><p></p><br>

                </div>
                <div class="twoC column last">
                    &nbsp;
                </div>
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home.html">Kamaelia</a>
    is an open source project originated from and guided by <a href="http://www.bbc.co.uk/rd"> BBC 
    Research</a>. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



