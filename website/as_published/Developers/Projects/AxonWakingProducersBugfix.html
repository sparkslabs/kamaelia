<html>
<head>
<title> Developers/Projects/AxonWakingProducersBugfix </title>
<meta name="description" content="Kamaelia - making concurrency simpler in python - Developers/Projects/AxonWakingProducersBugfix">
<meta name="keywords" content="python concurrency generators threads processes component system experts beginners media networking">
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
<span class="largertext">&nbsp;</span>
<!--   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span>  -->
<!--  </b> -->
</b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twoC column">
                    &nbsp;
                </div>
                <div class="eightC column">
                


<h2>Project Task Page: Axon Waking Producers Bugfix<br></h2>
<p><div style="float: right; border: solid;" class="twoC"><b> Status:</b> Running<br><b>Current Developers: </b> <i>MH</i><br><b>Current "inflight" dev location:</b> /branches/private_MH_axon_outboxwakeups<br><b>Start Date:</b> 20 October 2006<br><b>Expected End Date:</b> <i>31 November 2006</i><br><b>End Date:</b> <i>???</i><br><b>Date this page last updated:</b> <i>23 February 2007</i><br><b>Estimated effort so far:</b> 5 days<br></div><b><br></b></p><h2><b>Description</b></h2>To get Axon to wake up producer components when a message they have sent out is consumed. This used to be a feature of axon, but was removed when <a href='/Developers/Projects/AxonBoxDeliveryOptimisations'> Axon box delivery optimisations </a> were implemented. This is therefore effectively a bugfix.<br><br>This allows producers to sleep if an inbox they are trying to send to becomes full (because it is size limited) and then be woken when it becomes non-full.<br><br>Needed by the <a href='/Developers/Projects/MobileReframer'> Mobile reframer</a>.<br>
  
<br>Benefits:<br><ul><li>Reintroducing feature that was removed during earlier optimisations</li><li>Axon systems can self rate limit when a consumer runs slower than a producer<br></li></ul><h2>Inputs</h2>This section is largely about WHO
has influenced this task to do WHAT, and where possible WHY. It is also
about WHO to contact with regard to this task to influence what's going
on.<br><ul><li>Task Sponsor: MH, MS<br></li><li>Task Owner: MH<br></li><li>Developers involved: MH (development), MS (merge)<br></li><li>Users: MH, MS</li><li>Interested third parties: MH, MS, SJ (bbc internal)<br></li><li>Requirements</li><ul><li>MUST wake producer component when a message it sent is consumed</li><li>MUST wake producer component <br></li><li>SHOULD not require API or behaviour changes (components should not need to be rewritten)</li><li>MUST have some test suite coverage<br></li></ul></ul><br>Relevant Influencing factors:<br>
<ul><li>Need for rate limiting in Mobile Reframer</li><li>Status as an outstanding bug<br></li></ul>
<h2>Outputs</h2><h3>Expected</h3><ul><li>Modifications to Axon (initially in branch then merged into mainline code)</li><li>...including modifications and additions to the Axon test suite<br></li></ul><h3>Actual</h3><ul><li>Code:</li><ul><li>CVS branch: private_MH_axon_threads</li><li>Mainline code: /Code/Python/Axon/Axon/</li><ul><li>Modified: Microprocess, Component and Scheduler<br></li><li>Added: <font face="Courier New, monospace">threadedadaptivecommscomponent</font> to ThreadedComponent.py<br></li></ul><li>Mainline code: /Code/Python/Axon/Axon/Tests</li><ul><li>Tests removed that were now inapplicable</li><li>New tests added</li></ul></ul></ul><h3>Realistic possibilities arising as a result of activity on this task</h3><p>none<br></p><h2>Related Tasks</h2><h3>Tasks that directly enable this task (dependencies)</h3><ul><li>none<br></li></ul><h3>Sub Tasks</h3><ul><li>Development</li><li>Testing</li><li>Test suite additions<br></li></ul><h2>Task Log</h2><ul><li>20 October 2006 : Added developer Matt</li><li>20 October 2006 : <b>Task status changed</b> to running.</li><li>20 October 2006 : Matt : working on private_MH_axon_outboxwakeups branch</li><li>24 October 2006 : Matt : bulk of development and tests complete. Days spent: 5. Work switches back to <a href='/Developers/Projects/MobileReframer'> Mobile reframer</a> to adapt components to use these facilities.</li><li>Added developer Michael</li><li>December 2006 : Michael : Allocated to merge branch into mainline </li><li>21 February 2006 : Matt : takes over responsibility for merge<br></li></ul><br><h2>Discussion</h2>This bug-fix brings Axon up to equivalent, but not semantically identical, functionality to the original capabilities of Axon 1.0.<br><br><h4>Changes to behaviour/semantics</h4>The original semantics worked for a model where both inbox <i>and</i> outbox sizes could be limited, and a postman microprocess would transfer data along linkages from outboxes to inboxes. In that model:<br><ul><li>a consumer is woken when the postman delivers</li><li>a producer is woken when the postman collects</li></ul>However, the <a href='/Developers/Projects/AxonBoxDeliveryOptimisations'>box delivery optimisations</a> removed the concept of messages being left in an outbox and a postman to carry them. Instead they are immediately and directly put into the final destination inbox.<br><br>The differences can therefore be summarised as:<br><ul><li>only inboxes can be size limited</li><li>all producers linked to an inbox are woken whenever a message is consumed from that inbox</li></ul>In practical terms, this means that from the perspective of a component developer, behaviour has changed in the following way:<br><ul><li>a producer may be woken only to find the destination it is trying to send to is still full (because another producer send a message there)</li></ul>It was not deemed practical to perfectly replicate the old behaviour (without reverting to a postman style model) because of the lack of a concept of messages waiting for dispatch in the outbox.<br><h4>Performance issues<br></h4><p>It could be argued that this strategy of waking <i>all</i> producers may cause a significant performance hit to some Axon based systems as all producers linked to a consumer will be woken every time the consumer collects from that inbox.</p><p>An alternative would be to only wake producers when the inbox transitions from being full to becoming not-full. Alternatively, producers could only be woken if they explicitly request it.<br></p><p>However these ideas constitue a more fundamental change in behaviour that component developers would have to take into account, rather than being a simple bug-fix.</p><br><p>-- Matt Hammond, 23 February 2007<br></p><p><br></p>
                </div>
                <div class="twoC column last">
                    &nbsp;
                </div>
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home.html">Kamaelia</a>
    is an open source project originated from and guided by <a href="http://www.bbc.co.uk/rd"> BBC 
    Research</a>. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



