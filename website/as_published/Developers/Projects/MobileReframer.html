<html>
<head>
<title> Developers/Projects/MobileReframer </title>
<meta name="description" content="Kamaelia - making concurrency simpler in python - Developers/Projects/MobileReframer">
<meta name="keywords" content="python concurrency generators threads processes component system experts beginners media networking">
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
<span class="largertext">&nbsp;</span>
<!--   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span>  -->
<!--  </b> -->
</b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twoC column">
                    &nbsp;
                </div>
                <div class="eightC column">
                


<h2>Project Task Page: MobileReframer</h2><h2>Description<br></h2><p><div style="float: right; border: solid;" class="twoC"><b> Status:</b> Blocked - awaiting demonstration server to install onto<b><br>Current Developers: </b><i>Matt</i><b><br>Current "inflight" dev location:</b> <i>/Sketches/MH/MobileReframe</i><b><br>Start Date:</b> <i>12 October 2006</i><b><br>Major Milestone date:</b> --<b><br>Expected End Date:</b> 5 December 2006<b><br>End Date:</b> <i>---</i><b><br>Date this page last updated:</b> <i>30 November 2006</i><b><br>Estimated effort so far:</b> <i>21</i>.25<br></div> The
aim is to create a back-end tool that decodes a video clip; applies
edit decisisions (cutting, cropping and scaling); and re-encodes it.
The idea is to cut and crop video to make it suitable for playback on a
small screen mobile device.<br></p>This will slot in as a back-end for
a web based video reframing internal BBC demonstrator. A flash based
web front end will be used to generate the edit decision list as XML
data. This reframer tool will then be run by the server to apply those
edit decisions to a video clip. A user will be able to upload a video;
reframe it using the front end; then download the reframed video.<br><br>Benefits include:<br><br><ul><li>A good test for the Axon bugfix of enabling components to be woken when data is consumed at a destination's inbox.</li><li>Creation of video and audio file parsing and writing components</li><li>Creation of video processing components (cropping and scaling)</li></ul><h2>Inputs</h2>Task Sponsor: SJ (BBC internal)<br>Task Owner: Matt (MH)<br>Developers:<br><ul><li>Matt</li></ul>Users:<br><ul><li>SJ (BBC internal)<br></li></ul>Interested Third Parties:<br><ul><li>n/a</li></ul>Requirements (non exhaustive):<br><ul><li>MUST be launchable from the command line (MUST)<br></li><li>accept edit decisions as an XML file matching a defined schema (MUST)<br></li><li>Edit decisions may include only a subset of the original clip (MUST)<br></li><li>Edit decisions may sequence clips in a different order to that of the riginal video (WOULD LIKE)<br></li><li>Self rate limiting (so CPU and memory usage are held in check) (MUST)<br></li><li>Use ffmpeg/mencoder to decode and encode video (SHOULD)</li></ul>Relevant Influencing factors:<br>
<ul><li><i>eg release of a tool doing the same sort of thing that renders this non-relevant</i></li><li><i>people joining/leaving project</i></li><li><i>change of sponsorship</i></li><li><i>growth in users/thirdparties</i></li><li><i>tool dependency suitablility</i></li><li><i>unexpected complications</i></li></ul>
<h2>Outputs</h2><h3>Expected</h3><ul><li>Code in /Sketches<br></li><ul><li>New Video processing components</li><li>New Video and Audio file parsing and writing components</li><li>New XML parsing components<br></li><li>Experimental modifications to existing components to handle noSpaceInBox exceptions</li><ul><li>Pipeline, Graphline, Carousel, etc...</li></ul></ul><li>Webpages describing:</li><ul><li>architecture</li><li>how to use</li></ul><li>Feature in presentation to Mobile SIG (BBC internal)<br></li></ul><h3>
Actual</h3><ul><li>Code</li><ul><li>Mobile reframer specific:<br></li><ul><li>/Sketches/MH/MobileReframe/MobileReframer.py</li><ul><li>The mobile reframer application itself<br></li></ul></ul><ul><li>/Sketches/MH/MobileReframe/EDL.py</li></ul><ul><ul><li>Parsing of tokenised XML containing the Edit Decision List<br></li></ul></ul><li>Video components</li><ul><li>/Sketches/MH/Video/YUV4MPEG.py</li><ul><li>YUV4MPEG file format parsing/generation<br></li></ul><li>/Sketches/MH/Video/CropAndScale.py</li><ul><li>Cropping and scaling of video frames<br></li></ul></ul><li>Audio components:</li><ul><li>/Sketches/MH/audio/WAV.py</li><ul><li>WAV file format parsing<br></li></ul><li>/Sketches/MH/audio/ToWAV.py</li><ul><li>WAV file format generation<br></li></ul></ul><li>General purpose components:</li><ul><li>/Sketches/MH/MobileReframe/TagWithSequenceNumber.py <br></li><ul><li>Tagging data with sequence numbers<br></li></ul><li>/Sketches/MH/MobileReframe/OneShot.py <br></li><ul><li>Sending one-off messages<br></li></ul><li>/Sketches/MH/MobileReframe/PromptedTurnstile.py <br></li><ul><li>Buffering of data until needed<br></li></ul><li>/Sketches/MH/MobileReframe/FirstOnly.py <br></li><ul><li>Extracting the first item of data<br></li></ul><li>/Sketches/MH/MobileReframe/Chunk.py <br></li><ul><li>chunking of data to match a required chunkrate<br></li></ul><li>/Sketches/MH/MobileReframe/Sync.py <br></li><ul><li>waiting for 'n' items before continuing<br></li></ul><li>/Sketches/MH/MobileReframe/Collate.py <br></li><ul><li>collate all data together<br></li></ul><li>/Sketches/MH/MobileReframe/RangeFilter.py <br></li><ul><li>filter items not within specified ranges<br></li></ul><li>/Sketches/MH/MobileReframe/Max.py</li><ul><li>select the maximum value from a list<br></li></ul></ul><li>Chassis-style components:</li><ul><li>/Sketches/MH/MobileReframe/InboxControlledCarousel.py <br>
</li><ul><li>Variation of Carousel component<br></li></ul></ul><ul><li>/Sketches/MH/MobileReframe/Chassis.py <br>
</li><ul><li>box size limit setting versions of Carousel,Pipeline,Graphline<br>
  </li></ul><li>/Sketches/MH/MobileReframe/Seq.py <br>
</li><ul><li>runs one component then the next, then the next...<br></li></ul></ul><li>Process components:</li><ul><li>/Sketches/MH/MobileReframe/UnixProcess.py <br></li><ul><li>Variant of UnixProcess component with multiple I/O pipes and noSpaceInBox handling</li></ul></ul><li>XML components:</li><ul><li>/Sketches/MH/MobileReframe/SAXPromptedParser.py</li><ul><li>Parsing of a stream of XML data using SAX, outputting only when prompted for more data</li></ul></ul></ul><li>Webpages</li><ul><li><a href='/MobileReframer '> Explanation of how to use the mobile reframer </a><br></li></ul></ul><h3>Realistic possibilities arising as a result of activity on this task</h3><ul><li>New components for the mainline codebase</li><ul><li>review and merge some or all of the above components</li></ul><li>Writing a video player able to play anything that ffmpeg/mencoder/other tools can play<br></li></ul><h2>Related Tasks</h2><h3>Tasks that directly enable this task (dependencies)</h3><ul><li><a href='/Developers/Projects/AxonWakingProducersBugfix'> Axon bugfix</a> to re-introduce the waking of components if they have an outbox linked to an inbox from which an item has just been consumed.</li><li>Conversion of YUV to RGB pixel data (VideoSurface component)<br></li></ul><h3>Sub Tasks</h3><ul><li>Modifying/rewriting UnixProcess to:</li><ul><li>not throw away data</li><li>support named pipes for input and output<br></li><li>to allow rate limiting by boxes becoming full</li><ul><li>leave data in inbox(es) until the process can accept it</li><li>not accept data until the destination outbox is not full</li></ul></ul><li>Writing components</li><li>Deployment onto demonstration server<br></li></ul><br><h2>Task Log</h2><ul><li>12 October 2006 - Added developer Matt<br></li><li>20 October 2006 - Matt : development to date: Time spent 5 days. <b>Task status changed</b> to blocked - need to complete <a href='/Developers/Projects/AxonWakingProducersBugfix'> Axon bugfix </a> (development begins in branch <font face="Courier New, monospace">private_MH_axon_outboxwakeups</font>)<br></li><li>26 October 2006 - Matt : <b>Task status changed</b> to running - resumed development</li><li>10 November 2006 - Matt : Time spent 11 days. <b>Task status changed</b> to stasis - secondment for BBC internal project</li><li>20 November 2006 - Matt : <b>Task status changed</b> to running - resumed development<br></li><li>27 November 2006 - Matt : development complete. Most code documented Time spent 4 days. <b>Task status changed</b> to blocked - awaiting demonstration server to install onto</li><li>29 November 2006 - Matt : Minor bugs come to attention and are fixed. Adding to documentation. Time spend 1/2 day</li><li>15 December 2006 - Matt : Added <a href='/MobileReframer '> webpage describing how to use it </a>. Time spent 1/4 day.<br></li></ul><h2>Discussion</h2><p>Coping with size limited boxes:<br></p><ul><li>Creation
of components that cope sensibly with noSpaceInBox exceptions and still
can shutdown as soon as appropriate, without deadlocking/livelocking,
has proved much harder than anticipated.</li><li>Similarly, parsing stream data from inboxes, whilst only taking from the inbox when actually needed was non trivial to code too.</li><li>In particular developing and debugging the revised UnixProcess component took much longer than expected.<br></li><li>The least unpleasant approach developed can be seen in components such as <i>YUV4MPEGToFrame</i> and <i>MaxSpeedFileReader</i>.</li><li>Either
further approaches need trying out, or perhaps the existing approaches
might be worth wrapping into a mixin. Either way, further review and
discussion is required.<br></li></ul><p><br></p>
                </div>
                <div class="twoC column last">
                    &nbsp;
                </div>
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home.html">Kamaelia</a>
    is an open source project originated from and guided by <a href="http://www.bbc.co.uk/rd"> BBC 
    Research</a>. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



