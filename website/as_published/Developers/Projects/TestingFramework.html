<html>
<head>
<title> Developers/Projects/TestingFramework </title>
<meta name="description" content="Kamaelia - making concurrency simpler in python - Developers/Projects/TestingFramework">
<meta name="keywords" content="python concurrency generators threads processes component system experts beginners media networking">
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
<span class="largertext">&nbsp;</span>
<!--   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span>  -->
<!--  </b> -->
</b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twoC column">
                    &nbsp;
                </div>
                <div class="eightC column">
                









































<h2 id="head-c56d7c932f5d44641046aae5892bb3342b553c19">Kamaelia: Testing Framework</h2><h2 id="head-cb43cfbe3084966a3a3d76039ca664b41579c854">What is it?</h2><p class="line874"><div style="float: right; border: solid;" class="twoC"><b>NOTE/WARNING: </b>this is a speculative project that may become "the" testing framework. It does not have that status yet.</div> Kamaelia
Testing Framework aims to be a testing framework that will let
developers write automated tests of kamaelia components easily.</p><p class="line874">NOTE: this documentation is related to the first stage of the project, which has been suggested to be rewritten, so it may change completely in the near future.<br></p><h2 id="head-4ae61e667b2c73bd4538b78f2443acaacfb3a7e7">Where do I get it &amp; install it?</h2><p class="line867"><b>developers</b></p><p class="line867">It is currenty available in the private_PO_Tests branch. So, step by step:<b><br></b> </p><ul><li><p class="line862">svn co https://kamaelia.svn.sourceforge.net/svnroot/kamaelia/branches/private_PO_Tests/</p></li><li class="gap">cd Axon; sudo python setup.py # Axon is not changed from the /trunk version</li><li class="gap">cd Kamaelia; sudo python setup.py</li></ul>Enjoy<br><br><h2><b>How do I use it?</b></h2><ul><li>Once the system is installed, you can do the tests you want wherever you want (i.e. in your /Sketches, in /tmp, etc.).</li><ul><li>You need to import the class "KamTestCase" from the package Kamaelia.Testing.KamTestCase and subclass it</li><li>In this subclass, you can use setUp and tearDown just as you would do in PyUnit.</li><li>You can test code that has nothing to do with Axon.</li><li>If using Axon (which is the normal thing):</li><ul><li>You will first create the component under test</li><li>Then, you will call "initializeSystem" with the component under test as an argument</li><li>Then, you will be able to put messages to inboxes with the "put" method. This is, self.put('message','inbox').<br></li><li>You can also retrieve messages from the outboxes with the "get" method. You may use only a single parameter (the outbox name), or two parameter (the outbox name and the timeout in seconds). This is, self.get('outbox',timeout=2).<br></li><li>You can also check that a certain outbox of a component is empty after a period of time. This is, self.assertOutboxEmpty('outbox',timeout=5)</li><li>You can check that a component has or has not finished in a certain period of time this is, self.assertFinished(timeout=5) or self.assertNotFinished(timeout=5)</li><li>You can use all the assert* and fail* methods of a unittest.TestCase, which are documented <a href="http://docs.python.org/lib/testcase-objects.html" target="_blank">here</a>, to ensure that the output of the component is the one expected</li><li>You can skip output from a component (i.e. waiting from a certain output). In order to define the output you are waiting for, you can use a simple KamExpectMatcher.Matcher object, which just checks the == operator, or you can use KamExpectMatcher.RegexpMatcher, which uses regular expressions, or you can subclass KamExpectMatcher.Matcher for other behaviour. Then you can use it as of self.expect(matcherObject, 'outbox', timeout=5).</li><li>You can provide mock components to avoid dealing with resources that may be difficult to handle with during testing [i.e. disk or networks usage]</li></ul><li>In order to provide some working examples, you can check:</li><ul><li>A simple example that tests a very simple component, but does all the very basic steps to test it. <a href="https://kamaelia.svn.sourceforge.net/svnroot/kamaelia/trunk/Sketches/PO/test_examples/example1.py" target="_blank">Here</a>.<br></li><li>A simple example that interacts with a very simple component, providing inputs and outputs. <a href="https://kamaelia.svn.sourceforge.net/svnroot/kamaelia/trunk/Sketches/PO/test_examples/example2.py" target="_blank">Here</a>.<br></li><li>A simple example that interacts with the same component in the previous example, but that skips some outputs using the KamExpectMatcher.* matchers. <a href="https://kamaelia.svn.sourceforge.net/svnroot/kamaelia/trunk/Sketches/PO/test_examples/example3.py" target="_blank">Here</a>.<br></li><li>A simple example that interacts with a component that uses another component which would be difficult to deal with and may be mocked. <a href="https://kamaelia.svn.sourceforge.net/svnroot/kamaelia/trunk/Sketches/PO/test_examples/example4.py" target="_blank">Here</a>.</li></ul><li>There are some other (more complex) tests added:<br></li><ul><li>A clone of the first block of tests found in <a href="https://kamaelia.svn.sourceforge.net/svnroot/kamaelia/trunk/Sketches/MPS/GSOC08/MultiPipeTest.py" target="_blank">here</a> can be found <a href="https://kamaelia.svn.sourceforge.net/svnroot/kamaelia/trunk/Sketches/PO/testingMulticore/tests/test_Multicore.py" target="_blank">here</a>.</li><li>A couple of tests of HTTPClient can be found <a href="http://kamaelia.svn.sourceforge.net/svnroot/kamaelia/branches/private_PO_Tests/Kamaelia/Test/Protocol/HTTP/test_SimpleHTTPClient.py" target="_blank">here</a>.</li><li>Note that the tests added <a href="http://kamaelia.svn.sourceforge.net/svnroot/kamaelia/branches/private_PO_Tests/Kamaelia/Test/Testing/" target="_blank">here</a> test the testing framework, and thus they don't rely on it (and thus they are not tested as the tests above).</li></ul></ul><li>Since it relies on PyUnit, it can easily be integrated in continuous integration servers with the existing tools for integrating PyUnit on them.</li><ul><li>The existing tools for running the tests nightly in Kamaelia will work as expected. Since the runner used is unittest, the -v flag still works and thus you can run the tests and it will return the __doc__ and the state of the test (i.e. "Check Addition and Deletion of Inboxes ... ok").</li><li>The <a href="http://www.rittau.org/python/cruisecontrol/" target="_blank">existing tools</a> used for integrating PyUnit in CruiseControl may be used "out of the box" to integrate Kamaelia tests in this continuous integration server.</li><li>The same probably applies to other existing automated code testers (i.e. apycot)<br></li></ul></ul>
<h2 id="head-ab982e78aa80eb65225e149907cae69c7abf9889">Planned Schedule (July 7th: redefining it):</h2>
<ul><li>June 6</li><ul><li>Finish Unit-testing KamPlanet using the first approach<br>
(modify the approach as problems arise).</li><li>Start mocking "problematic" components (i.e. those which<br>
require network/disk/... access; file reader and http client) to test<br>
the interaction of all the components (except for the mocked ones) of<br>
KamPlanet.</li></ul><li>June 13</li><ul><li>Finish integration-testing KamPlanet by using these mock<br>
objects.</li><li>For this case (KamPlanet), add also integration testing with<br>
real HTTP servers (i.e. using python's SimpleHTTPServer etc.).</li><li>Start testing other kamaelia apps/libs reusing the same<br>
approach/objects, adapting them when problems arise. Order/number of<br>
these applications not yet decided (the most different the applications<br>
are, the best; GUI, network...), the number mainly depends on how many<br>
new problems raise while testing each new application.</li></ul><li>June 20</li><ul><li>(Keep testing other kamaelia apps/libs). Note that the aim of<br>
this task is not to test apps/libs but to check that the approach being<br>
used is good enough by testing apps/libs; a couple of apps/libs getting<br>
tested is only a collateral benefit. But, *at this stage*, I wouldn't<br>
worry too much if while improving the approach/framework when testing<br>
the 3rd app/lib I break the tests on the 1st app/lib.</li></ul><li>June 27</li><ul><li>(Keep testing other kamaelia apps/libs).</li></ul><li>July 4</li><ul><li>Freeze the testing framework API and complete/clean the<br>
tests of the tested apps/libs so that all of them work correctly with<br>
the current approach.</li><li>Finish code-documenting the framework and write a small<br>
tutorial on how to use it.</li><li>Start integrating the configuration on a continuous<br>
integration server (i.e. CruiseControl; it should be quite easy) or similar frameworks (APyCoT).</li></ul><li>July 11</li><ul><li>Finish integrating the testing framework with a continuous<br>
integration server (i.e. CruiseControl) or similar frameworks (APyCoT).</li><li>Complete last week's tutorial with a simple sample app<br>
developed using Test-Driven-Development and Continuous Integration. This<br>
(now bigger) tutorial will assume that Kamaelia installed and basic<br>
notions of Kamaelia; it will include a small introduction to TDD/CI; it<br>
will only reference the installation of the CI server but it will<br>
include its configuration for the sample app; the main point is<br>
including a big. The simple app should use the components that were<br>
especially difficult to work with in June.<br>
    </li></ul></ul>
<i>(not added Logging Framework schedule)</i><br>
<h2 id="head-38c970225e454db55841fa5cd8c542a5e0948c10">Progress (dates related to the weekly meeting - these are the "DONE" lines)</h2><ul><li><p class="line862">Started unit-testing KamPlanet, working on the unit-testing infrastructure.</p></li><li>KamPlanet modules mostly unit-tested with the new infrastructure, Tools and doc to deploy KamPlanet and more KamPlanet tests added, Mock infrastructure started and used</li><li>Moved all the test framework to internally use LikeFile, replaced previous implementations. Adapted all the KamPlanet tests to the new implementation. Started integration testing kamplanet.</li><li>Tested some stuff at HTTPClient/HTTPParser, a couple of bugs found and
fixed, trying to put the changes in a branch. Improvements, stats and
tests in KamPlanet. Tried to move from private_MPS_Scratch/**/LikeFile
to trunk/**/Handle in order to make the branch from trunk for testing
other stuff; still on it.</li><li>Branch created for the testing framework, with a minor modifications in
{Protocol.HTTP,Schedule}, tests and the testing framework itself. In
process of migrating to Handle (it still fails ~20% of times) to
replace LikeFile-based working testing framework, adding examples as
documentation</li></ul><h2 id="head-105aec3df2ff0e4fd9e666bbf89cba1902e148a1">Log/Discussion</h2><ul><li>First approach:<br></li><ul><li>scheduler steps-based.&nbsp;</li><ul><li>It counts how many steps it takes to do a task. If it takes too many steps, the testing framework asserts that it failed.<br></li><li>Advantage: when using a single processor, the results should be the same in different machines, so it becomes quite deterministic, which is very interesting when unit testing. This doesn't happen whenever you are testing components that use intrinsically not-deterministic components (such as those using the network, file system, external processes, etc.)</li></ul><li>Available prior to r4391 (with examples in KamPlanet tests), still available as KamPlanetTestCaseOld.py</li></ul><li>Second approach:</li><ul><li>time-based and expect command based</li><ul><li>Suggested by ms-</li><li>Now it asserts that the task has failed when certain seconds have passed</li><li>You can also assert that you wait for a certain output, discarding all the previous output. Or that the component output is empty (equivalent to expect's EOF). <br></li><ul><li>For this, you pass a Matcher subclass (which can be a Matcher -such as "I wait for a 5, or a 'hello world', or an instance of an object, for example, and it must be exactly that object-, or a RegexpMatcher -I'm waiting for something like '.*[A-Z]+' message-). In the future other Matchers could be implemented (like one comparing xmls as http://xmlunit.sf.net/ does)</li></ul><li>Advantage: it is more realistic than the previous approach, and more compfortable.</li></ul></ul></ul> <br>








                </div>
                <div class="twoC column last">
                    &nbsp;
                </div>
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home.html">Kamaelia</a>
    is an open source project originated from and guided by <a href="http://www.bbc.co.uk/rd"> BBC 
    Research</a>. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



