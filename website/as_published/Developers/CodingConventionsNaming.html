<html>
<head>
<title> Developers/CodingConventionsNaming </title>
<meta name="description" content="Kamaelia - making concurrency simpler in python - Developers/CodingConventionsNaming">
<meta name="keywords" content="python concurrency generators threads processes component system experts beginners media networking">
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
<span class="largertext">&nbsp;</span>
<!--   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span>  -->
<!--  </b> -->
</b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twoC column">
                    &nbsp;
                </div>
                <div class="eightC column">
                





























































































<h1>Developers/CodingConventionsNaming</h1>
<br><p><div style="float: right; border: solid;" class="twoC">This page consolidates <a href="http://groups.google.com/group/kamaelia/browse_frm/thread/dd2a717e1d137e98#">the discussion on the google groups regarding this topic</a>.</div></p><p>In many respects, a significant chunk of Kamaelia is actually about conventions around ensuring documentation is possible and natural. Matt did actually write up some documentation guidelines, which I then<br>editted and things got tweaked. <a href="/DocumentationGuidelines.html">These can be found here.</a>&nbsp; <something><something><something><something>Similarly, there is some basic guidance on naming of things and how they'll be used in the page describing a possible </something></something></something></something><a href="/Docs/.htmlNotationForVisualisingAxon">notation for visualising Axon/Kamaelia systems</a><something><something><something><something>.<br><br>However, it may be useful to go through some basic points on conventions that get used.<br></something></something></something></something></p><h2><something><something><something><something>Whitespace</something></something></something></something></h2><something></something>4 spaces.*** No tabs ***<br>No mixing of tabs and indents.<br>There's highly pragmatic reasons for this I can go into, but for now let's just say tabs have no place in Kamaelia :-)<br><h2><something><something><something><something>imports</something></something></something></something></h2><p><something><something><something><something>First of all, divide this into 3 main sets of lines of the form:<br>   * "import Foo"<br>   * "from Axon.<something> import <something><br>   * "from Kamaelia.<something> import <something><br><br>Never use:<br>   from foo import *<br></something></something></something></something></something></something></something></something></p><p>Unless you *know* that all the symbols exported by foo are expected to be used. (this is _very_ rare)<br></p><h2>Naming of things</h2><p></p><h3>Naming Components</h3><p>Components should use CamelCaseWording. (though single word names - like "Backplane" are fine). Names of things should be clear in what they do. Some of the complaints about names in the earlier thread are very valid, and worth bearing in mind.<br></p><h3>Naming Boxes</h3><p>Components SHOULD declare that they have the following 4 boxes:<br>   * inbox - We expect to generally expect the data we work on here.<br>   * control - we expect shutdown style messages here.<br><br>   * outbox - If your component produces output, it should go here.<br>   * signal - when you want to send shutdown messages (of various kinds) they should get sent here.<br><br><something><something><something><something><something><something><something><something></something></something></something></something></something></something></something></something></p><p>If you do not include these boxnames, the component cannot be used inside a Pipeline. The vast majority of components tend to be able to work using these default 4 names.<br><br>Additional boxnames should always be lower case.<br><br>If you do not expect anyone _outside_ the component to connect to an inbox or outbox the component has, then the inbox and outbox name should start with an underscore. These sorts of boxes are usually used by a parent component to talk to subcomponents. For a visual example, see the "Notation" link above.<br><br>Boxnames which are not any of the defaults should indicate what sort of thing is sent to them and why (insofar that's sensible).<br><br>Whilst you can declare boxes this way...<br><br><something><something><something><something><something><something><something><something>class Foo(Axon.Component.component):<br>    Inboxes = ["inbox", "control", "imageupdate"]<br>    Outboxes = ["outbox", "signal", "debuglog"]<br><br>... since actually the key thing is Inboxes and Outboxes needs to be an iterable that returns strings, it is preferable that it be a dictionary, so that the documentation system can pick things up - this allows someone introspecting a component to understand what each box is for:<br><br>class Foo(Axon.Component.component):<br>    Inboxes = {<br>        "inbox" : "what sort of message we expect here &amp; why",<br>        "control" : "what sort of message we expect here &amp; why",<br>        "imageupdate" : "what sort of message we expect here &amp; why",<br>    }<br>    Outboxes = {<br>        "outbox" : "what we send here and why",<br>        "signal" : "what we send here and why",<br>        "debuglog" : "what we send here and why",<br>    }<br><br>Note the trailing commas on the last item in each pair. This is<br>deliberate.<br></something></something></something></something></something></something></something></something></p><h2><something><something><something><something><something><something><something><something>Use of Boxes</something></something></something></something></something></something></something></something></h2><h3><something><something><something><something><something><something><something><something></something></something></something></something></something></something></something></something></h3><p><something><something><something><something><something><something><something><something>If a box is not linked, it has no default storage. This means sending to an outbox like this:</something></something></something></something></something></something></something></something></p><p><something><something><something><something><something><something><something><something>self.send("debug message", "debug_log")<br><br>Will not result in messages piling up - they'll be thrown away unless the box is linked up.<br></something></something></something></something></something></something></something></something></p><h2><something><something><something><something><something><something><something><something>Initialisation Issues</something></something></something></something></something></something></something></something></h2><h2><something><something><something><something><something><something><something><something></something></something></something></something></something></something></something></something></h2><p><something><something><something><something><something><something><something><something>This has evolved over the course of Kamaelia. There are 3 approaches you will see in Kamaelia's codebase. 1 should be completely eradicated by now, the other 2 are in a transition period, since one is an improvement on the other. I'll also note a bug.<br><br>Buggy/broken/never ever do:<br><br>class Foo(Axon.Component.component):<br>   def __init__(self, arg1, arg2, arg3):<br>       Axon.Component.component.__init__(self) &lt;---- broken<br>       self.arg1 = arg1<br>       self.arg2 = arg2<br>       self.arg3 = arg3<br><br>Very old, deprecated to the extent I think of it as a bug: (will be broken in esoteric circumstances)<br><br>   def __init__(self, logfile = "greylist.log", debuglogfile =<br>"greylist-debug.log"):<br>        self.__super.__init__() &lt;-------- This is the bit deprecated.<br>        self.logfile = logfile<br>        self.debuglogfile = debuglogfile<br>        self.inbox_log = []<br>        self.line = None<br><br>Older, deprecated, but not a bug:<br><br>class MailHandler(Axon.Component.component):<br>   def __init__(self, logfile = "greylist.log", debuglogfile =<br>"greylist-debug.log"):<br>        super(MailHandler, self).__init__() &lt;-------- preferable<br>        self.logfile = logfile<br>        self.debuglogfile = debuglogfile<br>        self.inbox_log = []<br>        self.line = None<br><br>Modern approach, which is much more preferable:<br><br>class MailHandler(Axon.Component.component):<br>    logfile = "greylist.log"<br>    debuglogfile = "greylist-debug.log"<br>    def __init__(self,**argd):       &lt;--- Note, completely offloaded<br>the value<br>        super(MailHandler, self).__init__(**argd)  &lt;---- Best<br>        self.inbox_log = []<br>        self.line = None<br><br>It's worth noting that these last 2 mail handler definitions work the same way. You can still do this:<br><br>MailHandler(logfile = "/var/log/mail.log", debug = "/tmp/ maildebug.log")<br><br>But the latter option also allows this:<br><br>class MyMailHandler(MailHandler):<br>    logfile = "/var/log/mail.log"<br>    debuglogfile = "/tmp/maildebug.log"<br></something></something></something></something></something></something></something></something></p><h2><something><something><something><something><something><something><something><something>Naming/Use of Subcomponents</something></something></something></something></something></something></something></something></h2><h2><something><something><something><something><something><something><something><something></something></something></something></something></something></something></something></something></h2><p><something><something><something><something><something><something><something><something>In the past this has been a matter of "just use the components you want to use as subcomponents". However, similar to initialisation above this has evolved.<br><br>Suppose your component creates and uses a number of subcomponents, you could do this:<br><br>from Kamaelia.Frob import Frobnicator<br>from Kamaelia.Wotsits import Cruncher<br>from Kamaelia.Smash import Smasher<br><br>   def __init__(...)<br>      ...<br>      self.frobber = Frobnicator(...)<br>      self.smashy = Smasher(...)<br>      self.muncher = Cruncher(...)<br>     # and then later on link the components up inside main() once the<br>component is started.<br><br>This is OK and we've done this for years, but there's something much<br>nicer you can do:<br><br>import Kamaelia.Frob<br>import Kamaelia.Wotsits<br>import Kamaelia.Smash<br><br>class MyComponent(Axon.Component.component):<br>    Frobnicator = Kamaelia.Frob.Frobnicator<br>    Cruncher = Kamaelia.Wotsits.Cruncher<br>    Smasher = Kamaelia.Smash.Smasher<br>    def __init__(...)<br>       ...<br>       self.frobber = self.Frobnicator(...)<br>       self.smashy = self.Smasher(...)<br>       self.muncher = self.Cruncher(...)<br>      # and then later on link the components up inside main() once<br>the component is started.<br><br>On the surface of things, this looks like it introduces more complexity for no benefit. In practice it introduces a huge new level of abilities, which you can see used in the greylisting code.<br><br>Snipping out the key part that benefits:<br><br>class GreylistServer(MoreComplexServer):<br>    port = config["port"]<br>    class TCPS(TCPServer):<br>        CSA = NoActivityTimeout(ConnectedSocketAdapter,<br>timeout=config["inactivity_timeout"],<br> <br>debug=False)<br>    class protocol(GreyListingPolicy):<br>        servername = config["servername"]<br>        serverid = config["serverid"]<br>        smtp_ip = config["smtp_ip"]<br><br>What you'll see here is that this subclasses an existing component called (rather unimaginatively) MoreComplexServer. However, it overrides how the server listens for connections, by changing the what self.TCPS would refer to. Specifically it creates a new class called TCPS, which subclasses TCPServer in order to change how connections are handled.<br><br>Quite literally it allows you to delve deep inside components in the tree, rummage around and change the one little detail that needs changing to support the thing you need - in this case it was to add an inactivity timeout to connected sockets created by the TCP server/listener component inside the server factory.<br><br>In the example above, this would mean someone could do this:<br>import Kamaelia.Frob<br>import Kamaelia.Wotsits<br>import Kamaelia.Smash<br><br>class ShinyComponent(MyComponent):<br>    class Frobnicator(Kamaelia.Frob.Frobnicator):<br>           # local overrides<br>    class Cruncher(Kamaelia.Wotsits.Cruncher):<br>           # local overrides<br>    class Smasher(Kamaelia.Smash.Smasher):<br>           # local overrides<br><br>And whilst that might seem overkill, it can certainly be useful. It's the sort of change you'd make to code though once it was all working and known useful.<br></something></something></something></something></something></something></something></something></p><h2>Names of Variables</h2><p>you should not use globals. Ever. If you must, please look at the STM<br>code.<br><br>variables containing things you expect to be constant should be<br>UPPERCASE<br><br>variables should be lowercase<br>attributes should be lowercase<br><br>If it's clearer lowercase can mean <br>"lowercaseStartingPhraseLikeThisIfYouMust".<br><br>Variables should have a good clear name reflecting use. When in a list comprehension, use x,y,z (ideally) as the loop values - eg:<br><br>   items = [ (x,y) for x,y in someList if x == y ]<br><br>In a loop where you're interested in values, do this sort of name:<br></p><blockquote>    for item in items: # Note the plural...<br>    for person in people:<br></blockquote><p><br>If just looping over numbers:<br>    for i in xrange(100)<br><br>If you are looping over a generator, waiting for it to finish (cf what happens in some pygame components), you're not actually caring what the value is. If that's the case make this explicit by using the variable name "_". eg:<br></p><blockquote>for _ in self.waitBox("control"): yield 1<br></blockquote><p><br>There are better ways of handling this now (see the greylister for an example of better practice), but this is the legacy approach and shows the one context where that name is useful.<br></p><h2>Naming of Methods<br></h2><p>Method names should follow the same rules as variables.<br><br>Unlike "normal" python code, you should NOT need to ever do something like this:<br>        def _shutdown(self):<br><br>ie you should NOT ever need to have a method name with a leading underscore. The reason for this is because it is defined as bug for someone to do this...<br>     mycomponent = SomeComponent( ....)<br>     mycomponent.doSomething()<br><br>... except in *extraordinarily* few cases.<br><br><br>Since I've referenced it a few times, the greylister is here: https://kamaelia.svn.sourceforge.net/svnroot/kamaelia/branches/private_MPS_Scratch/Apps/Kamaelia-Grey/App/greylisting.py <br><br>... and it shows a number of points which are best practice.<br><br>I think I'll leave this at that for now, but what haven't I covered?<br><br>   * I haven't covered <i>behaviour</i> of initialisation, running &amp; shutdown<br>   * I haven't covered communication<br>   * I haven't covered that the "three callback form" is now completely and utterly deprecated. It's turned out to be unnecessary in practice and tends to just make code harder to work with. Therefore modern components  should NOT have the following 3 methods:<br>        def initialiseComponent(self):<br>        def mainBody(self):<br>        def closeDownComponent(self):<br><br>     And a component SHOULD have the following method:<br>        def main(self):<br><br>And is generally recommend to have the following ones:<br>        def __init__(self, ...):<br>        def shutdown(self):<br>        def main(self):<br>        def stop(self): # should handle being called repeatedly safely<br><br>Regarding the points I haven't covered here - which largely relate to <b>behaviour.</b><br></p><p>Other people, please do jump in with where you feel  things have worked well...<br><br></p><p><something><something><something><something><something><something><something><something>Michael, May 2008</something></something></something></something></something></something></something></something></p>

















                </div>
                <div class="twoC column last">
                    &nbsp;
                </div>
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home.html">Kamaelia</a>
    is an open source project originated from and guided by <a href="http://www.bbc.co.uk/rd"> BBC 
    Research</a>. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



