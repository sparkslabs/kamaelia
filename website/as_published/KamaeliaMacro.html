<html>
<head>
<title> KamaeliaMacro </title>
<meta name="description" content="Kamaelia - making concurrency simpler in python - KamaeliaMacro">
<meta name="keywords" content="python concurrency generators threads processes component system experts beginners media networking">
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
<span class="largertext">&nbsp;</span>
<!--   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span>  -->
<!--  </b> -->
</b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twoC column">
                    &nbsp;
                </div>
                <div class="eightC column">
                




<h1>Kamaelia Macro</h1>
<p align="right"><span style="font-size: 18pt;">Tools for timeshifting</span></p>
<div style="width:425px;float:right; text-align:left" id="__ss_127990"><object style="margin:0px" width="425" height="355"><param name="movie" value="http://static.slideshare.net/swf/ssplayer2.swf?doc=timeshift-everything-miss-nothing-mashup-your-pvr-with-kamaelia4498"/><param name="allowFullScreen" value="true"/><param name="allowScriptAccess" value="always"/><embed src="http://static.slideshare.net/swf/ssplayer2.swf?doc=timeshift-everything-miss-nothing-mashup-your-pvr-with-kamaelia4498" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="355"></embed></object><div style="font-size:11px;font-family:tahoma,arial;height:26px;padding-top:2px;"><a href="http://www.slideshare.net/?src=embed"><img src="http://static.slideshare.net/swf/logo_embd.png" style="border:0px none;margin-bottom:-5px" alt="SlideShare"/></a> | <a href="http://www.slideshare.net/kamaelian/timeshift-everything-miss-nothing-mashup-your-pvr-with-kamaelia?src=embed" title="View Timeshift Everything, Miss Nothing - Mashup your PVR with Kamaelia on SlideShare">View</a> | <a href="http://www.slideshare.net/upload?src=embed">Upload your own</a></div></div>
<p>For more context on timeshifting in Kamaelia, <a href="http://kamaelia.sourceforge.net/ToolsForTimeshifting.html">please see this page</a>.</p>
<p><span style="font-size: 14pt; font-weight: 600;">What is it?</span></p>
<p>It records and transcodes what is broadcast over DTT for future viewing. It is essentially a form of timeshifting. It is currently at a prototype stage, and as such the contents of this page is subject to change. Programs are captured, transcoded and then made avallable for viewing in a variety of formats. The two primary formats are suitable for handheld TV's and <span style="font-style: italic;">relatively </span>small living room TVs. </p>
<p>The resulting data is forwarded to a simple front end for demonstration purposes. The current front end can be found here, and has not been active that long - please be gentle!</p>
<ul type="disc"><li><a href="http://bbc.kamaelia.org/cgi-bin/blog/blog.cgi">http://bbc.kamaelia.org/cgi-bin/blog/blog.cgi</a></li></ul>
<p><span style="font-size: 14pt; font-weight: 600;">High Level Architecture</span></p>
<p>The high level architecture is as follows:</p>
<p><img src='/images/macro_1.1.png'></p>
<p>This might seem too high level. However, due to Kamaelia's nature, this has a direct mapping to the underlying code.</p>
<ul type="disc"><div><pre>Graphline(<br>    SOURCE=DVB_Multiplex(754, [640, 641, 620, 621, 622,<br>                               610, 611, 612, 600, 601,<br>                               18]),<br>    DEMUX=DVB_Demuxer({<br>        "640": ["NEWS24"], "641": ["NEWS24"],<br>        "600": ["BBCONE"], "601": ["BBCONE"],<br>        "610": ["BBCTWO"], "611": ["BBCTWO"],<br>        "620": ["CBBC"],   "621": ["CBBC"],<br>        "18", [ "NEWS24", "BBCONE", "BBCTWO", "CBBC" ]<br>    }),<br>    NEWS24=ChannelTranscoder(base="News24"),<br>    BBCONE=ChannelTranscoder(base="bbcone"),<br>    BBCTWO=ChannelTranscoder(base="bbctwo"),<br>    CBBC=ChannelTranscoder(base="cbbc"),<br>    linkages={<br>       ("SOURCE", "outbox"):("DEMUX","inbox"),<br>       ("DEMUX", "NEWS24"): ("NEWS24", "inbox"),<br>       ("DEMUX", "BBCONE"): ("BBCONE", "inbox"),<br>       ("DEMUX", "BBCTWO"): ("BBCTWO", "inbox"),<br>       ("DEMUX", "CBBC"): ("CBBC", "inbox"),<br>    }<br>).run()<br></pre></div></ul>
<p><span style="font-size: 14pt; font-weight: 600;">Channel Transcoding</span></p>
<p>A channel transcoder takes the data it recieves and splits it into two.</p>
<ul type="disc"><li>Scheduling information - EIT data - is extracted, and sent to an EIT Handler. This looks for events - specifically programme changes. When there's a programme change it spits out the information regarding the programme. This "programme change" event is also used to break up the transcoding, as we shall see shortly. The EIT information is also stored as a MIME like object with a name that increments.</li>
<li>The audio/video data relating to the channel. To handle this a Unix Shell out component - a <span style="font-weight: 600;">Pipethrough</span> component is created. This performs the actual transcoding to a given filename. The filename increments and matches the EIT data. The transcoding is specifically done by performing a shell out to  <tt><span style="">mencoder</tt></span>.</li></ul>
<p>Diagrammatically, this looks like this: (only one actual transcoder shown for simplicity)</p>
<p><img src='/images/macro_1.2.png'></p>
<p>The interesting point is what happens when there's a programme event change. In this circumstance, new transcoders are created, and the audio visual data is sent to them. The original transcoders are sent shutdown messages telling them to shutdown after completing their transcoding. This then triggers the copying of the transcoded data &amp; captured metadata to a location where the (currently simple) frontend can access it.</p>
<p>Diagrammatically, the replumbing looks like this:</p>
<p><img src='/images/macro_1.3.png'></p>
<p>Specifically, files are created of the form:</p>
<ul type="disc"><li>channelname.programmeid.bitrate.avi # 200 Kbit/s</li>
<li>channelname.programmeid.bitrate.avi # 512 Kbit/s</li>
<li>channelname.programmeid.bitrate.DONE # 200 Kbit/s</li>
<li>channelname.programmeid.bitrate.DONE # 512 Kbit/s</li>
<li>channelname.programmeid.META</li></ul>
<p><span style="font-weight: 600;">Primitive Front End</span></p>
<p>The existing front end is a simple prototype that shows how a standard single channel can be made to look like a RSS feed like any other "web" channel. This can be found here:</p>
<ul type="disc"><li><a href="http://bbc.kamaelia.org/cgi-bin/blog/blog.cgi">http://bbc.kamaelia.org/cgi-bin/blog/blog.cgi</a></li></ul>
<p>A snapshot of the current view:</p>
<ul type="disc"><div><img src='/images/macro_1.4.png'></div></ul>
<p><span style="font-weight: 600;">This is not the end...</span></p>
<p>The code &amp; system described here is not the final version. The upcoming release of Kamaelia &amp; Axon (0.4.0 and 1.5.0 respectively) will include the simple version of Macro as an example, in examples 15 specifically. Until then in order to use this you'll want to grab a bundle, follow the instructions for getting started, and then get a recent CVS snapshot. Please contact us for help in getting started. Once again though, bear in mind that these tools have been created for legal timeshifting purposes only.</p>
<p>If you're interested in collaborating on building this and taking this technology forward (or perhaps even building into a domestic PVR, or a personal/homebrew PVR) we'd be very interested in hearing from you!</p>
<p><span style="font-weight: 600;">End Notes</span></p>
<p>Kamaelia tools for timeshifting are relatively nascent, but as can be seen can be used for a variety of interesting uses already. As it should be clear, extending these systems to do more would be relatively simple. For example rebroadcasting the transcoded data using multicast is a relatively simple extension. </p>
<p dir="ltr">Regarding Kamaelia, this work has been useful so far for driving a large amount of optimisation work for the core system - Axon. This has had a number of knockon effects, such as making collaborative whiteboarding a realistically useful tool.</p>
<p dir="ltr"><hr width='100%'></p>
<p dir="ltr">Michael, May 2006</p>
<p dir="ltr"></p>




                </div>
                <div class="twoC column last">
                    &nbsp;
                </div>
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home.html">Kamaelia</a>
    is an open source project originated from and guided by <a href="http://www.bbc.co.uk/rd"> BBC 
    Research</a>. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



