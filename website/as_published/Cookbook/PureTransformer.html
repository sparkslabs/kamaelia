<html>
<head>
<title> Cookbook/PureTransformer </title>
<meta name="description" content="Kamaelia - making concurrency simpler in python - Cookbook/PureTransformer">
<meta name="keywords" content="python concurrency generators threads processes component system experts beginners media networking">
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
<span class="largertext">&nbsp;</span>
<!--   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span>  -->
<!--  </b> -->
</b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twoC column">
                    &nbsp;
                </div>
                <div class="eightC column">
                


<h1>Cookbook: PureTransformer</h1>
A number of components have a common format - specifically they take every piece of data they receive, transform it somehow, and pass the data on. Take for example this exampe from the <a href="../../../Cookbook/HTTPClient">HTTPClient page</a>:<blockquote>                                                                                    <pre><b>import</b> feedparser<br><b>import</b> pprint<br><b>import</b> Axon<br><b>from </b>Kamaelia.Chassis.Pipeline <b>import</b> Pipeline<br><b>from </b>Kamaelia.Util.Console <b>import </b>ConsoleReader, ConsoleEchoer<br><b>from </b>Kamaelia.Protocol.HTTP.HTTPClient <b>import</b> SimpleHTTPClient<br><br><i><font color="#33cc00"><b>class </b></font></i>Feedparser<font color="#33cc00"><i><span style="background-color: rgb(255, 255, 255);">(Axon.Component.component):</span><br style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255);">    </span><b style="background-color: rgb(255, 255, 255);">def</b><span style="background-color: rgb(255, 255, 255);"> main(self):</span><br style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255);">        </span><b style="background-color: rgb(255, 255, 255);">while </b><span style="background-color: rgb(255, 255, 255);">1:</span><br style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255);">            </span><b style="background-color: rgb(255, 255, 255);">while</b><span style="background-color: rgb(255, 255, 255);"> self.dataReady("inbox"):</span><br style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255);">                data = self.recv("inbox")</span><br style="background-color: rgb(255, 255, 255);"></i><span style="background-color: rgb(255, 255, 255);"><i>                parseddata =</i> </span></font><font style="background-color: rgb(255, 255, 255);" color="#ff0000"><b>feedparser.parse</b></font><i><font color="#33cc00"><span style="background-color: rgb(255, 255, 255);">(data)</span><br style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255);">                self.send(parseddata, "outbox")</span><br style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255);">            </span><b style="background-color: rgb(255, 255, 255);">if not</b><span style="background-color: rgb(255, 255, 255);"> self.anyReady():</span><br style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255);">                self.pause()</span><br style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255);">            </span><b style="background-color: rgb(255, 255, 255);">yield</b><span style="background-color: rgb(255, 255, 255);"> 1</span><br style="background-color: rgb(255, 255, 255);"><br style="background-color: rgb(255, 255, 255);"><b style="background-color: rgb(255, 255, 255);">class</b><span style="background-color: rgb(255, 255, 255);"> </span></font></i>PrettyPrinter<font color="#33cc00"><i>(Axon.Component.component):<br>    <b>def</b> main(self):<br>        <b>while</b> 1:<br>            <b>while</b> self.dataReady("inbox"):<br>                data = self.recv("inbox")<br>                prettified =</i> <font color="#ff0000"><b>pprint.pformat</b></font><i>(data)<br>                self.send(prettified, "outbox")<br>            <b>if not</b> self.anyReady():<br>                self.pause()<br>            <b>yield</b> 1</i></font><br><br>Pipeline(<br>    ConsoleReader(eol=""),<br>    SimpleHTTPClient(),<br>    Feedparser(),<br>    PrettyPrinter(),<br>    ConsoleEchoer(),<br>).run()</pre></blockquote><p>In the example above, the important part of the example is highlighted <font color="#ff0000"><b>red</b></font> the common parts of the components are highlight in <font color="#33cc00"><i>green</i>.</font> Clearly this amount of boiler plate code actually hides what's actually going on here. As a result the PureTransformer component exists.<br></p><p>
 </p><p>To show how this works, we'll leave the important part of the above example red, but show the shorter version here:</p><p></p><blockquote><pre><b>import</b> feedparser<br><b>import</b> pprint<br><b>import</b> Axon<br><b>from </b>Kamaelia.Chassis.Pipeline <b>import</b> Pipeline<br><b>from </b>Kamaelia.Util.Console <b>import </b>ConsoleReader, ConsoleEchoer<br><b>from </b>Kamaelia.Protocol.HTTP.HTTPClient <b>import</b> SimpleHTTPClient<br><b>from</b> Kamaelia.Util.PureTransformer <b>import</b> PureTransformer<br><br>Pipeline(<br>    ConsoleReader(eol=""),<br>    SimpleHTTPClient(),<br>    PureTransformer(<font color="#33cc00"><span style="background-color: rgb(255, 255, 255);"></span></font><font style="background-color: rgb(255, 255, 255);" color="#ff0000"><b>feedparser.parse</b></font><i><font color="#33cc00"><span style="background-color: rgb(255, 255, 255);"></span></font></i>), <i># Feedparser</i><br>    PureTransformer(<font><font color="#33cc00"><font color="#ff0000"><b>pprint.pformat</b></font></font></font>),   # <i>PrettyPrinter</i><br>    ConsoleEchoer(),<br>).run()<br></pre></blockquote>The biggest downside of the PureTransformer is that you sometimes lose the <i>intent</i> behind a component due to the reused name. As a result, creating a prefab is sometimes a nice idea. What's a prefab? It's simply a function ! <br><br><h2>Using a Prefab to show Intent</h2><blockquote><pre><b>import</b> feedparser<br><b>import</b> pprint<br><b>import</b> Axon<br><b>from </b>Kamaelia.Chassis.Pipeline <b>import</b> Pipeline<br><b>from </b>Kamaelia.Util.Console <b>import </b>ConsoleReader, ConsoleEchoer<br><b>from </b>Kamaelia.Protocol.HTTP.HTTPClient <b>import</b> SimpleHTTPClient<br><b>from</b> Kamaelia.Util.PureTransformer <b>import</b> PureTransformer<br><br>def Feedparser(): return PureTransformer(<font color="#33cc00"><span style="background-color: rgb(255, 255, 255);"></span></font><font style="background-color: rgb(255, 255, 255);" color="#ff0000"><b>feedparser.parse</b></font><i><font color="#33cc00"><span style="background-color: rgb(255, 255, 255);"></span></font></i>)<br>def PrettyPrinter(): return PureTransformer(<font><font color="#33cc00"><font color="#ff0000"><b>pprint.pformat</b></font></font></font>)<br>&nbsp;<br>Pipeline(<br>    ConsoleReader(eol=""),<br>    SimpleHTTPClient(),<br>    Feedparser(),<br>    PrettyPrinter(),<br>    ConsoleEchoer(),<br>).run()</pre></blockquote>
<p>The nice thing here is we now have the best of both worlds - the code in the pipeline shows the intent, whereas the code performing the transforms now doesn't contain any repetition. The other nice thing about doing things this way is that you gain correct shutdown handling for free at the same time! :-)<br></p>-- Michael Sparks, December 2006<br><br>

                </div>
                <div class="twoC column last">
                    &nbsp;
                </div>
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home.html">Kamaelia</a>
    is an open source project originated from and guided by <a href="http://www.bbc.co.uk/rd"> BBC 
    Research</a>. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



