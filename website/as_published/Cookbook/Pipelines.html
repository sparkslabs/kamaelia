<html>
<head>
<title> Cookbook/Pipelines </title>
<meta name="description" content="Kamaelia - making concurrency simpler in python - Cookbook/Pipelines">
<meta name="keywords" content="python concurrency generators threads processes component system experts beginners media networking">
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
<span class="largertext">&nbsp;</span>
<!--   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span>  -->
<!--  </b> -->
</b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twoC column">
                    &nbsp;
                </div>
                <div class="eightC column">
                







<h1>Cookbook : Pipelines</h1>Pipelines are one of the simplest ways to wire components together. A Pipeline wires components together in a long chain.<br><br>Here's a simple pipeline we want to build that sends a file over multicast, using a simple protocol to ensure reliable transmission:<br><br><div align="center"><img src="/images/pipeline1_idea.gif" alt="We want to wire a set of components together in a long chain (a pipeline)"></div><br>We could build this by writing a new component with a whole bunch of self.link() calls to link each outbox to the next inbox. But that is a lot of code to write and rather tedious! ... surely there must be an easier way?<br><br>... And so the Pipeline component comes to the rescue! No need to write a whole new component, simply use a Pipeline component like this:<br><blockquote><pre><font color="#000000">from Kamaelia.Chassis.Pipeline import Pipeline<br><br>from Kamaelia.Internet.Multicast_transceiver import Multicast_transceiver<br>from Kamaelia.Protocol.SimpleReliableMulticast import Annotator<br>from Kamaelia.Protocol.SimpleReliableMulticast import _Framer<br>from Kamaelia.Protocol.SimpleReliableMulticast import _DataChunker<br>from Kamaelia.Protocol.Packetise import MaxSizePacketiser</font><br>from Kamaelia.File.Reading import RateControlledFileReader<br><br><font color="#000000"><b>Pipeline( RateControlledFileReader("myaudio.mp3",readmode="bytes",rate=128000/8),<br>          Annotator(),<br>          _Framer(),<br>          _DataChunker(),<br>          MaxSizePacketiser(),<br>          Multicast_transceiver("0.0.0.0", 0, "224.168.2.9", 1600),<br>        ).run()</b></font><br></pre></blockquote><p>You can find this code in <tt> Kamaelia/Examples/Multicast/SimpleReliableMulticast </tt><br></p><p>So what did Pipeline actually do?</p><p align="center"><img src="/images/pipeline1_intention.gif" alt="Pipeline component does this for us"></p>It
wires the components into a chain inside itself - linking outboxes to
inboxes. When we call the run() method, the Kamaelia system starts, and
the pipeline component is activated. It in turn, activates all the
components inside.<br><h3>How are the components linked together?</h3><div style="float: right; border: solid;" class="twoC"> <b>Just like unix pipes</b><br>
"inbox"
and "outbox" are a lot like standard-input and standard-output for
command line programs. When you pipe programs together on a unix shell,
the standard-output of one program gets sent to the standard-input of
the next.<br>
<br>
"control" and "signal" are analogous to standard-error. In practice Kamaelia components use it to signal when they are finished.<br>
</div><br>
More specifically, Pipeline links one component to the next in the chain. It links the "outbox" and "signal" outboxes of one component to the "inbox" and "control" inboxes on the next one:<br><ul><li>The
"inbox" and "outbox" boxes are the ones most components use to take in
and send out data. So for example, whatever the RateControlledFileReader
component reads gets sent to the Annotator component.<br><br> </li><li>The
"control" and "signal" boxes are used to send the shutdown message when
a component has finished, and wants to tell the next.</li></ul>So, if we look at precisely what linkages are made, we see something like this:<br><br><div align="center"><img src="/images/pipeline1_inside.gif" alt="Pipeline component links " outbox="" inbox="" and="" signal="" to="" control=""></div><br><h3>Pipeline is a component too ... time to go modular!<br></h3>The Pipeline also links its own inboxes and outboxes to the
start and the end (respectively) of the chain. Pipeline is, after all, a
component too, so it makes sense to be able to send and receive messages to/from the pipeline of components within
using its inboxes and outboxes. Think of it as a kind of container.<br><br>You can therefore use a Pipeline as a way to wrap up a useful pipelined set of components into a single bundle that you can then reuse elsewhere.<br><br>For
example, we could separate the components that make the multicast reliability protocol into another Pipeline, and simply include it like another component:<br><blockquote><pre>Pipeline( RateControlledFileReader("myaudio.mp3",readmode="bytes",rate=128000/8),<br>          <b>Pipeline( Annotator(),<br></b>                     <b>_Framer(),<br></b>                     <b>_DataChunker(),<br></b>                   <b>),</b><br>          MaxSizePacketiser(),<br>          Multicast_transceiver("0.0.0.0", 0, "224.168.2.9", 1600),<br>        ).run()<br></pre></blockquote>We don't have to call the run() or activate() method of the inner pipeline since, just like the other components, they'll all be activated by the main pipeline when it starts.<br><br>In fact, we could actually move that into a completely separate function, that simply returns the pipeline:<br><blockquote><pre>def SRM_Sender():<br>   return Pipeline( Annotator(),<br>                    _Framer(),<br>                    _DataChunker(),<br>                  )<br></pre></blockquote><p>Now we can call that function to put the sub pipeline into the chain:<br></p><blockquote><pre>Pipeline( RateControlledFileReader("myaudio.mp3",readmode="bytes",rate=128000/8),<br>          <b>SRM_Sender(),</b><br>          MaxSizePacketiser(),<br>          Multicast_transceiver("0.0.0.0", 0, "224.168.2.9", 1600),<br>        ).run()</pre></blockquote>We can now, for the most part, use SRM_Sender just like any other component.<br><br>This hopefully makes the design of the system more modular and clearer, and also give us a re-usable
component for applying our multicast reliability protocol - which we previously didn't
have. In fact, this has already been done so you can simply import it and use it:<br><blockquote><pre><b>from Kamaelia.Protocol.SimpleReliableMulticast import SRM_Sender</b><br><br>Pipeline( RateControlledFileReader("myaudio.mp3",readmode="bytes",rate=128000/8),<br>          SRM_Sender(),<br>          MaxSizePacketiser(),<br>          Multicast_transceiver("0.0.0.0", 0, "224.168.2.9", 1600),<br>        ).run()</pre></blockquote><h3>Need more flexibility?</h3>Pipelines are not the only quick and easy way to link up components. Perhaps you need to make different links? Try a <a href='/Cookbook/Graphlines '> Graphline </a> instead.<br><br>-- 18 Dec 2006 - Matt Hammond<br><br>

                </div>
                <div class="twoC column last">
                    &nbsp;
                </div>
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home.html">Kamaelia</a>
    is an open source project originated from and guided by <a href="http://www.bbc.co.uk/rd"> BBC 
    Research</a>. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



