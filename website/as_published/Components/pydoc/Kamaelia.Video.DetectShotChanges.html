<html>
<head>
<title> Components/pydoc/Kamaelia.Video.DetectShotChanges </title>
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span> 
  </b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twelveC column"> 
                <html>
<head>
<title>Kamaelia docs : Kamaelia.Video.DetectShotChanges</title>
<style type="test/css">
pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }
</style>
</head>
<body>
<div class="container">
<div class="section">
<h1><a class="reference" href="/Components/pydoc/Kamaelia.html">Kamaelia</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Video.html">Video</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Video.DetectShotChanges.html">DetectShotChanges</a></h1>
</div>
<div class="section">
<div class="container">
<ul class="simple">
<li><strong>component <a class="reference" href="/Components/pydoc/Kamaelia.Video.DetectShotChanges.DetectShotChanges.html">DetectShotChanges</a></strong></li>
</ul>
</div>
<ul class="simple">
<li><a class="reference" href="#667">Detecting cuts/shot changes in video</a><ul>
<li><a class="reference" href="#668">Example Usage</a><ul>
</ul>
</li>
<li><a class="reference" href="#669">More detail</a><ul>
</ul>
</li>
<li><a class="reference" href="#670">Implementation details</a><ul>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#671">UNCOMPRESSED FRAME FORMAT</a><ul>
</ul>
</li>
</ul>
</div>
<div class="section">
<div class="section">
<h2 id="667"><a id="detecting-cuts-shot-changes-in-video" name="detecting-cuts-shot-changes-in-video">Detecting cuts/shot changes in video</a></h2>
<p>DetectShotChanges takes in (framenumber, videoframe) tuples on its &quot;inbox&quot; inbox and
attempts to detect where shot changes have probably occurred in the sequence.
When it thinks one has ocurred, a (framenumber, confidencevalue) tuple is sent
out of the &quot;outbox&quot; outbox.</p>
<div class="section">
<h3 id="668"><a id="example-usage" name="example-usage">Example Usage</a></h3>
<p>Reading in a video in uncompressed YUV4MPEG file format, and outputting the
frame numbers (and confidence values) where cuts probably occur:</p>
<pre class="literal-block">
Pipeline( RateControlledFileReader(..)
          YUV4MPEGToFrame(),
          TagWithSequenceNumber(),      # pair up frames with a frame number
          DetectShotChanges(threshold=0.85),
          ConsoleEchoer(),
        ).run()
</pre>
<p>Expect output like this:</p>
<pre class="literal-block">
(17, 0.885)(18, 0.912)(56, 0.91922)(212, 0.818)(213, 0.825)(214, 0.904) ...
</pre>
</div>
<div class="section">
<h3 id="669"><a id="more-detail" name="more-detail">More detail</a></h3>
<p>Send (frame-number, video-frame) tuples to this component's &quot;inbox&quot; inbox and
(frame-number, confidence-value) tuples will be sent out of the &quot;outbox&quot; outbox
whenever it thinks a cut has occurred.</p>
<p>Frames must be in a YUV format. See below for details. Frame numbers need not
necessarily be sequential; but they must be unique! If they are not, then it is
your own fault when you can't match up detected shot changes to actual video
frames!</p>
<p>Internally, the cut detector calculates a 'confidence' value representing how
likely that a shot change has occurred. At initialisation you set a threshold
value - if the confidence value reaches or exceeds this threshold, then a cut
is deemed to have taken place, and output will be generated.</p>
<p>How do you choose a threshold? It is a rather inexact science (as is the
subjective decision of whether something consitutes a shot change!) - you really
need to get a feel for it experimentally. As a rough guide, values between 0.8
and 0.9 are usually reasonable, depending on the type of video material.</p>
<p>Because of the necessary signal processing, this component has a delay of
several frames of data through it before you will get output. It therefore will
not necessarily detect cuts in the first 15 frames or so of a sequence sent to
it. Neither will it generate any output for the last 15 frames or so - they
will never make it through the internal signal processing.</p>
<p>Send a producerFinished() or shutdownMicroprocess() message to this component's
&quot;control&quot; inbox and it will immediately terminate. It will also forward on the
message out of its &quot;signal&quot; outbox.</p>
</div>
<div class="section">
<h3 id="670"><a id="implementation-details" name="implementation-details">Implementation details</a></h3>
<p>The algorithm used is based on a simple &quot;mean absolute difference&quot; between pixels
of one frame and the next; with some signal processing on the resulting stream
of frame-to-frame difference values, to detect a spike possibly indicating a
shot change.</p>
<p>The algorithm is courtesy of Jim Easterbrook of BBC Research. It is also
available in its own right as an independent open source library
<a class="reference" href="http://sourceforge.net/projects/shot-change">here.</a></p>
<p>As signal processing is done on the confidence values internally to emphasise
spikes - which are likely to indicate a sudden increase in the level of change
from one frame to the next - a conseuqence is that this component
internally buffers inter-frame difference values for several frames, resulting
in a delay of about 15 frames through this component. This is the reason why
it is necessary to pair up video frames with a frame number, otherwise you
cannot guarantee being able to match up the resulting detected cuts with the
actual frame where they took place!</p>
<p>The change detection algorithm only looks at the Y (luminance) data in the video
frame.</p>
</div>
</div>
<div class="section">
<h2 id="671"><a id="uncompressed-frame-format" name="uncompressed-frame-format">UNCOMPRESSED FRAME FORMAT</a></h2>
<p>A frame is a dictionary data structure. It must, for this component, at minimum
contain a key &quot;yuv&quot; that returns a tuple containing (y_data, u_data, v_data).</p>
<p>Any other entries are ignored.</p>
</div>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="reference" href="/Components/pydoc/Kamaelia.html">Kamaelia</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Video.html">Video</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Video.DetectShotChanges.html">DetectShotChanges</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Video.DetectShotChanges.DetectShotChanges.html">DetectShotChanges</a></h1>
<div class="section">
<h2 id="symbol-DetectShotChanges">class DetectShotChanges(<a class="reference" href="/Docs/Axon/Axon.Component.component.html">Axon.Component.component</a>)</h2>
<p>DetectShotChanges([threshold]) -&gt; new DetectShotChanges component.</p>
<p>Send (framenumber, videoframe) tuples to the &quot;inbox&quot; inbox. Sends out
(framenumber, confidence) to its &quot;outbox&quot; outbox when a cut has probably
occurred in the video sequence.</p>
<p>Keyword arguments:</p>
<ul class="simple">
<li>threshold  -- threshold for the confidence value, above which a cut is detected (default=0.9)</li>
</ul>
<div class="section">
<h3><a id="symbol-DetectShotChanges.Inboxes" name="symbol-DetectShotChanges.Inboxes">Inboxes</a></h3>
<ul class="simple">
</ul>
</div>
<div class="section">
<h3><a id="symbol-DetectShotChanges.Outboxes" name="symbol-DetectShotChanges.Outboxes">Outboxes</a></h3>
<ul class="simple">
</ul>
</div>
<div class="section">
<h3>Methods defined here</h3>
<div class="container">
<div style="float: right; border: solid;" class="twoC"> <p><strong>Warning!</strong></p>
<p>You should be using the inbox/outbox interface, not these methods (except construction). This documentation is designed as a roadmap as to their functionalilty for maintainers and new component developers.</p>
</div></div>
<div class="section">
<h4><a id="symbol-DetectShotChanges.__init__" name="symbol-DetectShotChanges.__init__">__init__(self[, threshold])</a></h4>
</div>
<div class="section">
<h4><a id="symbol-DetectShotChanges.detectCut" name="symbol-DetectShotChanges.detectCut">detectCut(self, framenum, ydata)</a></h4>
</div>
<div class="section">
<h4><a id="symbol-DetectShotChanges.main" name="symbol-DetectShotChanges.main">main(self)</a></h4>
<p>Main loop</p>
</div>
</div>
<div class="section">
</div>
</div>
</div>
</div>





<div class="section">
<h1>Feedback</h1>
<p>Got a problem with the documentation? Something unclear that could be clearer?
Want to help improve it? Constructive criticism is very welcome - especially if you can suggest a better rewording!</p>
<p>Please leave you feedback
<a class="reference" href="../../../cgi-bin/blog/blog.cgi?rm=viewpost&amp;nodeid=1142023701">here</a>
in reply to the documentation thread in the Kamaelia blog.</p>
</div>


<p><i>-- Automatic documentation generator, 05 Jun 2009 at 03:01:38 UTC/GMT</i>
</body></html>

                </div> 
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home>5D">Kamaelia</a>
    is an open source project originated from and guided by BBC
    Research. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved.
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



