<html>
<head>
<title> Components/pydoc/Kamaelia.Audio.RawAudioMixer </title>
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span> 
  </b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twelveC column"> 
                <html>
<head>
<title>Kamaelia docs : Kamaelia.Audio.RawAudioMixer</title>
<style type="test/css">
pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }
</style>
</head>
<body>
<div class="container">
<div class="section">
<h1><a class="reference" href="/Components/pydoc/Kamaelia.html">Kamaelia</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Audio.html">Audio</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Audio.RawAudioMixer.html">RawAudioMixer</a></h1>
</div>
<div class="section">
<div class="container">
<ul class="simple">
<li><strong>component <a class="reference" href="/Components/pydoc/Kamaelia.Audio.RawAudioMixer.RawAudioMixer.html">RawAudioMixer</a></strong></li>
</ul>
</div>
<ul class="simple">
<li><a class="reference" href="#549">Multi-source Raw Audio Mixer</a><ul>
<li><a class="reference" href="#550">Example Usage</a><ul>
</ul>
</li>
<li><a class="reference" href="#551">How does it work?</a><ul>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#552">Test documentation</a><ul>
</ul>
</li>
</ul>
</div>
<div class="section">
<h1 id="549">Multi-source Raw Audio Mixer</h1>
<p>A component that mixes raw audio data from an unknown number of sources, that
can change at any time. Audio data from each source is buffered until a minimum
threshold amount, before it is included in the mix. The mixing operation is a
simple addition. Values are not scaled down.</p>
<div class="section">
<h2 id="550"><a id="example-usage" name="example-usage">Example Usage</a></h2>
<p>Mixing up to 3 sources of audio (sometimes a source is active, sometimes it
isn't):</p>
<pre class="literal-block">
Graphline(
    MIXER = RawAudioMixer( sample_rate=8000,
                           channels=1,
                           format=&quot;S16_LE&quot;,
                           readThreshold=1.0,
                           bufferingLimit=2.0,
                           readInterval=0.1),
                         ),
    A = pipeline( SometimesOn_RawAudioSource(), Entuple(prefix=&quot;A&quot;) ),
    B = pipeline( SometimesOn_RawAudioSource(), Entuple(prefix=&quot;B&quot;) ),
    C = pipeline( SometimesOn_RawAudioSource(), Entuple(prefix=&quot;C&quot;) ),

    OUTPUT = RawSoundOutput( sample_rate=8000,
                             channels=1
                             format=&quot;S16_LE&quot;,
                           ),
           linkages = {
               (A, &quot;outbox&quot;) : (MIXER, &quot;inbox&quot;),
               (B, &quot;outbox&quot;) : (MIXER, &quot;inbox&quot;),
               (C, &quot;outbox&quot;) : (MIXER, &quot;inbox&quot;),

               (MIXER, &quot;outbox&quot;) : (OUTPUT, &quot;inbox&quot;),
           },
         ).run()
</pre>
<p>Each source is buffered for 1 second before it is output. If more than 2 seconds
of audio are buffered, then samples are dropped.</p>
</div>
<div class="section">
<h2 id="551"><a id="how-does-it-work" name="how-does-it-work">How does it work?</a></h2>
<p>Send (id, raw-audio) tuples to RawAudioMixer's inbox. Where 'id' is any value
that uniquely distinguishes each source of audio.</p>
<p>RawAudioMixer buffers each source of audio, and mixes them together additively,
outputting the resulting stream of audio data.</p>
<p>Constructor arguments:</p>
<blockquote>
<ul class="simple">
<li>sample_rate, channels, format
The format of audio to be mixed. The only format understood at the moment
is &quot;S16_LE&quot;</li>
<li>readThreshold
number of seconds of audio that will be buffered before RawAudioMixer
starts mixing it into its output.</li>
<li>bufferingLimit
maximum number of seconds of audio that will be buffered. If more piles up
then some audio will be lost.</li>
<li>readInterval
number of seconds between each time RawAudioMixer outputs a chunk of audio
data.</li>
</ul>
</blockquote>
<p>RawAudioMixer buffers each source of audio separately. If the amount of audio in
any buffer exceeds the 'buffering limit' then the oldest samples buffered will
be lost.</p>
<p>When one or more buffered sources reaches the 'read threshold' then they are
mixed together and output. How often audio is output is determined by setting
the 'read Interval'.</p>
<p>Mixing is done additively and is <em>not</em> scaled down (ie. it is a sum() function,
not an average() ). Therefore, ensure that the sum of the sources being mixed
does not exceed the range of values that samples can take.</p>
<p>Why the buffering, thresholds, and read intervals? It is done this way so that
RawAudioMixer can mix without needing to know what sources of audio there are,
and whether they are running or stopped. It also enables RawAudioMixer to cope
with audio data arriving from different sources at different times.</p>
<p>You may introduce new audio sources at any time - simply send audio data tagged
with a new, unique identifier.</p>
<p>You may stop an audio source at any time too - simply stop sending audio data.
The existing buffered data will be output, until there is not left.</p>
<p>If there is not enough audio in any of the buffers (or perhaps there are no
sources of audio) then RawAudioMixer will not output anything, not even
'silence'.</p>
<p>If a shutdownMicroprocess or producerFinished message is received on this
component's &quot;control&quot; inbox this component will cease reading in data from any
audio sources. If it is currently outputting audio from any of its buffers, it
will continue to do so until these are empty. The component will then forward
on the shutdown message it was sent, out of its &quot;signal&quot; outbox and immediately
terminate.</p>
<p>TODO:</p>
<blockquote>
<ul class="simple">
<li>Needs a timeout mechanism to discard very old data (otherwise this is
effectively a memory leak!)<ul>
<li>If an audio source sends less than the readThreshold amount of audio
data, then stops; then this data never gets flushed out.</li>
</ul>
</li>
</ul>
</blockquote>
</div>
<h1 id="552">Test documentation</h1>
<p>Tests passed:</p>
<ul class="simple">
<li>Multiple sources of audio will be mixed</li>
<li>If there is no input (no incoming audio data), there will be no output (no outgoing audio data)</li>
<li>A single source of audio will pass through</li>
</ul>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="reference" href="/Components/pydoc/Kamaelia.html">Kamaelia</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Audio.html">Audio</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Audio.RawAudioMixer.html">RawAudioMixer</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Audio.RawAudioMixer.RawAudioMixer.html">RawAudioMixer</a></h1>
<div class="section">
<h2 id="symbol-RawAudioMixer">class RawAudioMixer(<a class="reference" href="/Docs/Axon/Axon.ThreadedComponent.threadedcomponent.html">Axon.ThreadedComponent.threadedcomponent</a>)</h2>
<p>RawAudioMixer([sample_rate][,channels][,format][,readThreshold][,bufferingLimit][,readInterval]) -&gt; new RawAudioMixer component.</p>
<p>Mixes raw audio data from an unknown number of sources, that
can change at any time. Audio data from each source is buffered until a minimum
threshold amount, before it is included in the mix. The mixing operation is a
simple addition. Values are not scaled down.</p>
<p>Send (uniqueSourceIdentifier, audioData) tuples to the &quot;inbox&quot; inbox and
mixed audio data will be sent out of the &quot;outbox&quot; outbox.</p>
<p>Keyword arguments:</p>
<ul class="simple">
<li>sample_rate     -- The sample rate of the audio in Hz (default=8000)</li>
<li>channels        -- Number of channels in the audio (default=1)</li>
<li>format          -- Sample format of the audio (default=&quot;S16_LE&quot;)</li>
<li>readThreshold   -- Duration to buffer audio before it starts being used in seconds (default=1.0)</li>
<li>bufferingLimit  -- Maximum buffer size for each audio source in seconds (default=2.0)</li>
<li>readInterval    -- Time between each output chunk in seconds (default=0.1)</li>
</ul>
<div class="section">
<h3><a id="symbol-RawAudioMixer.Inboxes" name="symbol-RawAudioMixer.Inboxes">Inboxes</a></h3>
<ul class="simple">
</ul>
</div>
<div class="section">
<h3><a id="symbol-RawAudioMixer.Outboxes" name="symbol-RawAudioMixer.Outboxes">Outboxes</a></h3>
<ul class="simple">
</ul>
</div>
<div class="section">
<h3>Methods defined here</h3>
<div class="container">
<div style="float: right; border: solid;" class="twoC"> <p><strong>Warning!</strong></p>
<p>You should be using the inbox/outbox interface, not these methods (except construction). This documentation is designed as a roadmap as to their functionalilty for maintainers and new component developers.</p>
</div></div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.__init__" name="symbol-RawAudioMixer.__init__">__init__(self[, sample_rate][, channels][, format][, readThreshold][, bufferingLimit][, readInterval])</a></h4>
</div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.checkForShutdown" name="symbol-RawAudioMixer.checkForShutdown">checkForShutdown(self)</a></h4>
</div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.fillBuffer" name="symbol-RawAudioMixer.fillBuffer">fillBuffer(self, buffers, data)</a></h4>
</div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.main" name="symbol-RawAudioMixer.main">main(self)</a></h4>
</div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.mix_S16_LE" name="symbol-RawAudioMixer.mix_S16_LE">mix_S16_LE(self, sources, amount)</a></h4>
</div>
</div>
<div class="section">
</div>
</div>
</div>
</div>





<div class="section">
<h1>Feedback</h1>
<p>Got a problem with the documentation? Something unclear that could be clearer?
Want to help improve it? Constructive criticism is very welcome - especially if you can suggest a better rewording!</p>
<p>Please leave you feedback
<a class="reference" href="../../../cgi-bin/blog/blog.cgi?rm=viewpost&amp;nodeid=1142023701">here</a>
in reply to the documentation thread in the Kamaelia blog.</p>
</div>


<p><i>-- Automatic documentation generator, 05 Jun 2009 at 03:01:38 UTC/GMT</i>
</body></html>

                </div> 
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home>5D">Kamaelia</a>
    is an open source project originated from and guided by BBC
    Research. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved.
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



