<html>
<head>
<title> Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient </title>
<link rel=stylesheet type="text/css" href="/newcss.css">
  </head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>

<div id="centreinbrowser">
    <table><tr><td>
        <div id="contentwrapper">
            <div id="contentpanel">
                <div class="column twoC largertext">  &nbsp; </div>
                <div class="column twoC largertext">  &nbsp;  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b><a href="/Home.html"> Home</a></b> </div>
                <div class="column twoC largertext"> 
<P class="orange" align="center"> 
<b><a href="/About.html" class="smallertext">About</a>, 
<a href="/Sitemap.html" class="smallertext">Index</a>, 
<a href="/RecentChanges.html" class="smallertext">Changes</a></b>
  </div>
                <div class="column twoC largertext"> <P class="orange" align="center">  <b> <a href="/Developers/">Developers</a> </b> </div>
                <div class="column last twoC"> <P class="orange" align="center"> 
<b>
   <span class="largertext"><a href="/UserLogin.html">Login</a>/<a href="/UserRegistration.html">Register</a> </span> 
  </b>
 </div>

<div class="divide"></div>
                <div id="masthead">
                    &nbsp;
                    <br>
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column">
                    &nbsp;
                </div>
                <div class="fourC column last">
                    &nbsp;
                </div>
<div class="divide"></div>
                <div class="twelveC column"> 
                <html>
<head>
<title>Kamaelia docs : Kamaelia.Protocol.AIM.OSCARClient</title>
<style type="test/css">
pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }
</style>
</head>
<body>
<div class="container">
<div class="section">
<h1><a class="reference" href="/Components/pydoc/Kamaelia.html">Kamaelia</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.html">Protocol</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.html">AIM</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.html">OSCARClient</a></h1>
</div>
<div class="section">
<div class="container">
<ul class="simple">
<li><strong>prefab <a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.OSCARClient.html">OSCARClient</a></strong></li>
<li><strong>component <a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.OSCARProtocol.html">OSCARProtocol</a></strong></li>
<li><strong>component <a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.SNACExchanger.html">SNACExchanger</a></strong></li>
</ul>
</div>
<ul class="simple">
<li><a class="reference" href="#613">Kamaelia OSCAR interface</a><ul>
<li><a class="reference" href="#614">Explanation of Terms</a><ul>
</ul>
</li>
<li><a class="reference" href="#615">How does it work?</a><ul>
</ul>
</li>
<li><a class="reference" href="#616">Example Usage</a><ul>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section">
<h1 id="613">Kamaelia OSCAR interface</h1>
<p>NOTE: These components implement the OSCAR protocol at the lowest level and
require a fairly good knowledge of OSCAR to use them. For a high-level
interface, see AIMHarness.py.</p>
<ul class="simple">
<li>The OSCARProtocol component provides a Kamaelia interface for the FLAP level
of OSCAR protocol. You should not be linking to OSCARProtocol directly, but
to OSCARClient.</li>
<li>The OSCARClient prefab returns an OSCARProtocol component wired up to a
TCPClient.</li>
<li>SNACExchanger is the base class for all components that deal with the SNAC layer
of OSCAR protocol.</li>
</ul>
<div class="section">
<h2 id="614"><a id="explanation-of-terms" name="explanation-of-terms">Explanation of Terms</a></h2>
<p>NOTE: A &quot;byte&quot; in the following documentation refers to an ASCII char, an
unsigned char in C.</p>
<p>OSCAR messages are transmitted in discrete units called FLAPs, which take the
following form:</p>
<pre class="literal-block">
-------------------------------------------
|FLAP-header                              |
|   message start character (*) -- 1 byte |
|   channel -- 1 byte                     |
|   sequence number -- 2 bytes            |
|   length of following data -- 2 bytes   |
|-----------------------------------------|
| ------------                            |
||FLAP payload|                           |
| ------------                            |
-------------------------------------------
</pre>
<p>The sequence number is incremented with every FLAP sent. AOL is very strict
about in-order sequence numbers and servers may even disconnect a client for not
sending the right sequence numbers.</p>
<p>The majority of FLAP payloads (everything except new connection notifications,
really serious errors, shutdown notifications, and keepalives) are units called
SNACs and are transmitted over channel 2.</p>
<p>The structure of a SNAC:</p>
<pre class="literal-block">
--------------------------
|SNAC-header             |
|  family -- 2 bytes     |
|  subtype -- 2 bytes    |
|  request ID -- 2 bytes |
|  flags -- 4 bytes      |
|------------------------
|  --------------        |
| | SNAC payload |       |
|  --------------        |
--------------------------
</pre>
<p>All SNAC payloads must follow a prescribed format unique to the particular type
of SNAC, but all SNAC headers must follow the format described above. Each
different (family, subtype) performs a different function. For example, SNAC
(04, 07) (meaning family 0x04, subtype 0x07) carries AIM messages from the server
to the client, SNAC (01, 11) reports client idle times to the server, and
(04, 06) carries a message from one user to another.</p>
<p>Yet another type of OSCAR datatype is a type-length-value (TLV) unit.</p>
<p>The structure of a TLV:</p>
<pre class="literal-block">
------------------------------------------
|TLV-header                              |
|   type -- 2 bytes                      |
|   length of following data -- 2 bytes  |
|----------------------------------------|
|  ---------                             |
| |TLV data |                            |
|  ---------                             |
-----------------------------------------
</pre>
<p>TLVs may appear inside SNACs or just inside FLAPs.</p>
</div>
<div class="section">
<h2 id="615"><a id="how-does-it-work" name="how-does-it-work">How does it work?</a></h2>
<p>OSCARProtocol receives messages on its &quot;talk&quot; inbox in (channel, flap body)
format and retransmits them to &quot;outbox&quot; as true FLAPs. It receives FLAPs on its
&quot;inbox&quot; inbox and retransmits them to its &quot;heard&quot; outbox in the format
(channel, flap body). It also keeps track of sequence numbers.</p>
<p>OSCARClient returns a Graphline with an OSCARProtocol component's inbox/outbox
connected to a TCPClient's outbox/inbox. The Graphline's inbox and outbox are l
inked to the OSCARProtocol component's &quot;talk&quot; and &quot;heard&quot; boxes, respectively.
Send (channel, flap body) tuples to its inbox and receive (channel, flap body)
tuples from the outbox.</p>
<p>SNACExchanger provides specialized methods for dealing with SNACs. You must
subclass it, as it does not have a main method.</p>
</div>
<div class="section">
<h2 id="616"><a id="example-usage" name="example-usage">Example Usage</a></h2>
<p>To get an MD5 key from the authorization server during login:</p>
<pre class="literal-block">
class LoginHandler(SNACExchanger):
    def main(self):
        self.send((CHANNEL_NEWCONNECTION,
                   struct.pack('!i', 1)))
        while not self.dataReady():
            yield 1
        reply = self.recv() # server ack of new connection
        zero = struct.pack('!H', 0)
        request = TLV(0x01, &quot;kamaelia1&quot;) + TLV(0x4b, zero) + TLV(0x5a, zero)
        self.sendSnac(0x17, 0x06, request)
        for reply in self.waitSnac(0x17, 0x07): yield 1
        md5key = reply[2:]
        print (&quot;%02x &quot; * len(md5key)) % unpackSingles(md5key)

Graphline(osc = OSCARClient('login.oscar.aol.com', 5190),
          login = LoginHandler(),
          linkages = {(&quot;login&quot;, &quot;outbox&quot;) : (&quot;osc&quot;, &quot;inbox&quot;),
                      (&quot;osc&quot;, &quot;outbox&quot;) : (&quot;login&quot;, &quot;inbox&quot;),
                      }
          ).run()
</pre>
<p>For a more complete example, see LoginHandler.py</p>
</div>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="reference" href="/Components/pydoc/Kamaelia.html">Kamaelia</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.html">Protocol</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.html">AIM</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.html">OSCARClient</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.OSCARClient.html">OSCARClient</a></h1>
<div class="section">
<h2 id="symbol-OSCARClient">prefab: OSCARClient</h2>
<p>OSCARClient(server, port) -&gt; returns an OSCARProtocol component connected to
a TCPClient.</p>
<p>User input goes into OSCARClient's &quot;inbox&quot; in the form (channel, flap body)
and useable output comes out of &quot;outbox&quot; in the same form.</p>
</div>
<h1><a class="reference" href="/Components/pydoc/Kamaelia.html">Kamaelia</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.html">Protocol</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.html">AIM</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.html">OSCARClient</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.OSCARProtocol.html">OSCARProtocol</a></h1>
<div class="section">
<h2 id="symbol-OSCARProtocol">class OSCARProtocol(<a class="reference" href="/Docs/Axon/Axon.Component.component.html">Axon.Component.component</a>)</h2>
<p>OSCARProtocol() -&gt; new OSCARProtocol component.</p>
<p>Provides a Kamaelia interface to the lowest level of OSCAR protocol, the
FLAP level.</p>
<p>For more information on FLAPs, see module level docs.</p>
<div class="section">
<h3><a id="symbol-OSCARProtocol.Inboxes" name="symbol-OSCARProtocol.Inboxes">Inboxes</a></h3>
<ul class="simple">
<li><strong>control</strong> : shutdown handling</li>
<li><strong>inbox</strong> : receives binary data from the AIM server</li>
<li><strong>talk</strong> : receives messages in the format (channel, FLAP payload)</li>
</ul>
</div>
<div class="section">
<h3><a id="symbol-OSCARProtocol.Outboxes" name="symbol-OSCARProtocol.Outboxes">Outboxes</a></h3>
<ul class="simple">
<li><strong>outbox</strong> : sends binary data to the AIM server.</li>
<li><strong>signal</strong> : shutdown handling</li>
<li><strong>heard</strong> : resends messages from 'outbox' in the form (channel, FLAP payload)</li>
</ul>
</div>
<div class="section">
<h3>Methods defined here</h3>
<div class="container">
<div style="float: right; border: solid;" class="twoC"> <p><strong>Warning!</strong></p>
<p>You should be using the inbox/outbox interface, not these methods (except construction). This documentation is designed as a roadmap as to their functionalilty for maintainers and new component developers.</p>
</div></div>
<div class="section">
<h4><a id="symbol-OSCARProtocol.__init__" name="symbol-OSCARProtocol.__init__">__init__(self)</a></h4>
<p>x.__init__(...) initializes x; see x.__class__.__doc__ for signature</p>
</div>
<div class="section">
<h4><a id="symbol-OSCARProtocol.checkBoxes" name="symbol-OSCARProtocol.checkBoxes">checkBoxes(self)</a></h4>
<p>checks for data in all our boxes, and if there is data, then call the
appropriate function to handle it.</p>
</div>
<div class="section">
<h4><a id="symbol-OSCARProtocol.handlecontrol" name="symbol-OSCARProtocol.handlecontrol">handlecontrol(self)</a></h4>
</div>
<div class="section">
<h4><a id="symbol-OSCARProtocol.handleinbox" name="symbol-OSCARProtocol.handleinbox">handleinbox(self)</a></h4>
<p>receives data coming in through the wire, reformats it into a
Python-friendly form, and retransmits it to its &quot;heard&quot; outbox.</p>
</div>
<div class="section">
<h4><a id="symbol-OSCARProtocol.handletalk" name="symbol-OSCARProtocol.handletalk">handletalk(self)</a></h4>
<p>checks that incoming messages from the &quot;talk&quot; inbox are in a
(channel, flap data) tuple. If not, exceptions are raised. If so,
OSCARProtocol.sendFLAP is called.</p>
</div>
<div class="section">
<h4><a id="symbol-OSCARProtocol.main" name="symbol-OSCARProtocol.main">main(self)</a></h4>
<p>main loop</p>
</div>
<div class="section">
<h4><a id="symbol-OSCARProtocol.sendFLAP" name="symbol-OSCARProtocol.sendFLAP">sendFLAP(self, data[, channel])</a></h4>
<p>constructs FLAPs and sends them</p>
</div>
</div>
<div class="section">
</div>
</div>
<h1><a class="reference" href="/Components/pydoc/Kamaelia.html">Kamaelia</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.html">Protocol</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.html">AIM</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.html">OSCARClient</a>.<a class="reference" href="/Components/pydoc/Kamaelia.Protocol.AIM.OSCARClient.SNACExchanger.html">SNACExchanger</a></h1>
<div class="section">
<h2 id="symbol-SNACExchanger">class SNACExchanger(<a class="reference" href="/Docs/Axon/Axon.Component.component.html">Axon.Component.component</a>)</h2>
<p>SNACExchanger() -&gt; component that has methods specialized for sending and
receiving FLAPs over Channel 2 (FLAPs whose payloads are SNACs).</p>
<p>For a more thorough discussion on SNACs, see module level docs.</p>
<div class="section">
<h3><a id="symbol-SNACExchanger.Inboxes" name="symbol-SNACExchanger.Inboxes">Inboxes</a></h3>
<ul class="simple">
</ul>
</div>
<div class="section">
<h3><a id="symbol-SNACExchanger.Outboxes" name="symbol-SNACExchanger.Outboxes">Outboxes</a></h3>
<ul class="simple">
</ul>
</div>
<div class="section">
<h3>Methods defined here</h3>
<div class="container">
<div style="float: right; border: solid;" class="twoC"> <p><strong>Warning!</strong></p>
<p>You should be using the inbox/outbox interface, not these methods (except construction). This documentation is designed as a roadmap as to their functionalilty for maintainers and new component developers.</p>
</div></div>
<div class="section">
<h4><a id="symbol-SNACExchanger.__init__" name="symbol-SNACExchanger.__init__">__init__(self)</a></h4>
<p>x.__init__(...) initializes x; see x.__class__.__doc__ for signature</p>
</div>
<div class="section">
<h4><a id="symbol-SNACExchanger.recvSnac" name="symbol-SNACExchanger.recvSnac">recvSnac(self)</a></h4>
<p>receives FLAPs containing SNACs and parses the SNAC data.</p>
</div>
<div class="section">
<h4><a id="symbol-SNACExchanger.sendSnac" name="symbol-SNACExchanger.sendSnac">sendSnac(self, fam, sub, body)</a></h4>
<p>constructs a SNAC by calling self.makeSnac and sends it out the &quot;outbox&quot;.</p>
<p>FIXME:  It would be extremely helpful to have a predefined set of SNAC constants
or perhaps even classes to pass to this method.  For example, self.sendSnac(04, 06, data)
is a lot less clear than something like self.sendSnac(MESSAGE_TO_USER, data).</p>
</div>
<div class="section">
<h4><a id="symbol-SNACExchanger.waitSnac" name="symbol-SNACExchanger.waitSnac">waitSnac(self, fam, sub)</a></h4>
<p>Yields 1 until a SNAC of the requested family and subtype is received.
The last value yielded is the payload of the requested SNAC.</p>
<dl class="docutils">
<dt>Usage::</dt>
<dd>for result in self.waitSnac(family, subtype): yield 1.</dd>
</dl>
<p>The body of the requested SNAC will be assigned to &quot;result&quot;.</p>
</div>
</div>
<div class="section">
</div>
</div>
</div>
</div>





<div class="section">
<h1>Feedback</h1>
<p>Got a problem with the documentation? Something unclear that could be clearer?
Want to help improve it? Constructive criticism is very welcome - especially if you can suggest a better rewording!</p>
<p>Please leave you feedback
<a class="reference" href="../../../cgi-bin/blog/blog.cgi?rm=viewpost&amp;nodeid=1142023701">here</a>
in reply to the documentation thread in the Kamaelia blog.</p>
</div>


<p><i>-- Automatic documentation generator, 05 Jun 2009 at 03:01:38 UTC/GMT</i>
</body></html>

                </div> 
                <div id="footer">
                    &nbsp;
                    <br>&nbsp;
                </div>


<div class="divide"></div>
            </div>
        </div>
    </td></tr></table>


<hr>
<div id="aboutblock" style="text-align: left"; padding-left: 1em;>
<font size="-2">
   <P><img src="http://www.kamaelia.org/images/BBC-ResearchLogo-Small.png"
style="float: left; padding-right: 10px; margin-bottom: 3em;"> <a href="http://www.kamaelia.org/Home>5D">Kamaelia</a>
    is an open source project originated from and guided by BBC
    Research. For more information browse the site or get in 
    <a href="/Contact.html">contact</a>.
   <P>This is an ongoing community based development site. As a result the
   contents of this page is the opinions of the contributors of the pages
   involved not the organisations involved. Specificially, this page may
   contain personal views which are not the views of the BBC. (the site is
   powered by a wiki engine)
   <P>(C) Copyright 2008 Kamaelia Contributors, including the British
   Broadcasting Corporation, All Rights Reserved.
</font>
</div>
</div>
<div style="display:none">
This web site is powered by the same code created for the
<a href="http://www.bickermanor.org/"> bicker manor</a> project. For more
details, contact Michael Sparks at BBC Research directly (cf contact)
</div>
</body>
</html>



