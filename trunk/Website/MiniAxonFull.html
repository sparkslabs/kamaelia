<html><head><meta name="qrichtext" content="1" /></head><body style="font-size:10pt;font-family:URW Gothic L">
<p><span style="font-size:24pt;font-weight:600">Mini-Axon (complete)</span></p>
<p align="right"><span style="font-size:16pt">A Kamaelia Core in a Microcosm</span></p>
<p>See also: <a href="MiniAxon.html">Mini Axon</a>.</p>
<p dir="ltr"><span style="font-family:Courier;font-weight:600">[[pre]</span></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:600">class</span><span style="font-family:Courier"> microprocess(object):<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> __init__(self):<br />        super(microprocess, self).__init__()<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> main(self):<br />        </span><span style="font-family:Courier;font-weight:600">yield</span><span style="font-family:Courier"> 1</span></p>
<p></p>
<p><span style="font-family:Courier;font-weight:600">class</span><span style="font-family:Courier"> scheduler(microprocess):<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> __init__(self):<br />        </span><span style="font-family:Courier;font-weight:600">super</span><span style="font-family:Courier">(scheduler, self).__init__()<br />        self.active = []<br />        self.newqueue = []<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> main(self): <br />        </span><span style="font-family:Courier;font-weight:600">for</span><span style="font-family:Courier"> i </span><span style="font-family:Courier;font-weight:600">in </span><span style="font-family:Courier">xrange(100):<br />            </span><span style="font-family:Courier;font-weight:600">for </span><span style="font-family:Courier">current </span><span style="font-family:Courier;font-weight:600">in </span><span style="font-family:Courier">self.active:<br />                </span><span style="font-family:Courier;font-weight:600">yield</span><span style="font-family:Courier"> 1<br />                </span><span style="font-family:Courier;font-weight:600">try:</span><span style="font-family:Courier"><br />                    result = current.next()<br />                    </span><span style="font-family:Courier;font-weight:600">if </span><span style="font-family:Courier">result </span><span style="font-family:Courier;font-weight:600">is not</span><span style="font-family:Courier"> -1:<br />                        self.newqueue.append(current)<br />                </span><span style="font-family:Courier;font-weight:600">except </span><span style="font-family:Courier">StopIteration:<br />                    </span><span style="font-family:Courier;font-weight:600">pass</span><span style="font-family:Courier"><br />            self.active = self.newqueue<br />            self.newqueue = []<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> activateMicroprocess(self, someprocess):<br />        microthread = someprocess.main()<br />        self.newqueue.append(microthread)</span></p>
<p dir="ltr"></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:600">class</span><span style="font-family:Courier"> component(microprocess):<br />    Boxes = {<br />        &quot;inbox&quot; : &quot;This is where we expect to receive messages for work&quot;,<br />        &quot;outbox&quot; : &quot;This is where we expect to send results/messages to after doing work&quot;<br />    }<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> __init__(self):<br />        </span><span style="font-family:Courier;font-weight:600">super</span><span style="font-family:Courier">(component, self).__init__()<br />        self.boxes = {}<br />        for box in self.Boxes:<br />            self.boxes[box] = list()<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> send(self, value, outboxname):<br />        self.boxes[outboxname].append(value)<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> recv(self, inboxname):<br />        result = self.boxes[inboxname][0]<br />        </span><span style="font-family:Courier;font-weight:600">del</span><span style="font-family:Courier"> self.boxes[inboxname][0]<br />        </span><span style="font-family:Courier;font-weight:600">return</span><span style="font-family:Courier"> result<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> dataReady(self, inboxname):<br />        return len(self.boxes[inboxname])</span></p>
<p dir="ltr"></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:600">class</span><span style="font-family:Courier"> postman(microprocess):<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> __init__(self, source, sourcebox, sink, sinkbox):<br />        self.source = source<br />        self.sourcebox = sourcebox<br />        self.sink = sink<br />        self.sinkbox = sinkbox<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> main(self):<br />        </span><span style="font-family:Courier;font-weight:600">while</span><span style="font-family:Courier"> 1:<br />            </span><span style="font-family:Courier;font-weight:600">yield</span><span style="font-family:Courier"> 1<br />            </span><span style="font-family:Courier;font-weight:600">if</span><span style="font-family:Courier"> self.source.dataReady(self.sourcebox):<br />                d = self.source.recv(self.sourcebox)<br />                self.sink.send(d, self.sinkbox)</span></p>
<p dir="ltr"><span style="font-size:14pt">#<br /># Some sample code using the mini component<br /># system defined above<br />#</span></p>
<p dir="ltr"><span style="font-family:Courier;font-weight:600">class</span><span style="font-family:Courier"> Producer(component):<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> __init__(self, message):<br />        super(Producer, self).__init__()<br />        self.message = message<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> main(self):<br />        </span><span style="font-family:Courier;font-weight:600">while</span><span style="font-family:Courier"> 1:<br />            </span><span style="font-family:Courier;font-weight:600">yield</span><span style="font-family:Courier"> 1<br />            self.send(self.message, &quot;outbox&quot;)<br /><br /></span><span style="font-family:Courier;font-weight:600">class</span><span style="font-family:Courier"> Consumer(component):<br />    </span><span style="font-family:Courier;font-weight:600">def</span><span style="font-family:Courier"> main(self):<br />        count = 0<br />        </span><span style="font-family:Courier;font-weight:600">while</span><span style="font-family:Courier"> 1:<br />            </span><span style="font-family:Courier;font-weight:600">yield</span><span style="font-family:Courier"> 1<br />            count += 1 # This is to show our data is changing :-)<br />            </span><span style="font-family:Courier;font-weight:600">if</span><span style="font-family:Courier"> self.dataReady(&quot;inbox&quot;):<br />                data = self.recv(&quot;inbox&quot;)<br />                </span><span style="font-family:Courier;font-weight:600">print</span><span style="font-family:Courier"> data, count<br /><br />p = Producer(&quot;Hello World&quot;)<br />c = Consumer()<br />postie = postman(p, &quot;outbox&quot;, c, &quot;inbox&quot;)<br /><br />myscheduler = scheduler()<br />myscheduler.activateMicroprocess(p)<br />myscheduler.activateMicroprocess(c)<br />myscheduler.activateMicroprocess(postie)<br /><br /></span><span style="font-family:Courier;font-weight:600">for</span><span style="font-family:Courier"> _ </span><span style="font-family:Courier;font-weight:600">in</span><span style="font-family:Courier"> myscheduler.main():<br />    </span><span style="font-family:Courier;font-weight:600">pass</span></p>
<p>]</p>
</body></html>
